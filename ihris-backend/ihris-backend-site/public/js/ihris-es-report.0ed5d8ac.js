"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[844],{2591:function(t,e,s){s.r(e),s.d(e,{default:function(){return P}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-container",{staticClass:"py-5"},[s("v-card",{staticClass:"py-4 px-2"},[t.hideLabel?t._e():s("v-card-title",{staticClass:"ma-4"},[s("v-layout",{attrs:{row:"",wrap:""}},[t._v(" "+t._s(t.label)+" "),s("v-spacer"),s("v-row",{staticClass:"pr-4",attrs:{align:"center",justify:"end"}},[s("v-btn",{staticClass:"mr-2",attrs:{color:"primary"},on:{click:function(){t.dialog=!0}}},[s("v-icon",{attrs:{left:""}},[t._v("mdi-chart-box-plus-outline")]),t._v(" Customize Report "+t._s(t.$t("App.hardcoded-texts.Customize Report"))+" ")],1),s("v-btn",{attrs:{color:"info"},on:{click:function(e){return t.reportExport("csv")}}},[t.downloading?s("v-progress-circular",{attrs:{color:"amber",indeterminate:""}}):s("v-icon",{attrs:{left:""}},[t._v("mdi-microsoft-excel")]),t._v(" "+t._s(t.$t("App.hardcoded-texts.Export"))+" ")],1)],1)],1)],1),s("v-divider",{staticClass:"my-2"}),t.hideLabel?t._e():s("v-card-title",[t._t("default")],2),t.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[t._v(t._s(t.error_message)+" ")]):t._e(),s("v-data-table",{staticClass:"elevation-1 mt-3",staticStyle:{cursor:"pointer"},attrs:{"footer-props":{"items-per-page-options":t.itemsPerPage},headers:t.headers,items:t.results,loading:t.loading,options:t.options,"server-items-length":t.total,"show-select":t.reportData.displayCheckbox&&!t.hideCheckboxes,"item-key":"id"},on:{"update:options":function(e){t.options=e}},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})],1),s("v-row",{attrs:{justify:"center"}},[s("v-dialog",{attrs:{"max-width":"80%",persistent:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[s("v-card",{staticClass:"px-6 py-4"},[s("v-card-title",{staticClass:"justify-center"},[s("span",{staticClass:"text-h6"},[s("v-icon",{staticClass:"mr-2",attrs:{color:"primary",large:""}},[t._v("mdi-table-check")]),t._v(t._s(t.$t("App.hardcoded-texts.selectFeild")))],1)]),s("v-card-text",[s("v-container",{attrs:{fluid:""}},[s("v-row",t._l(t.allHeaders,(function(e){return s("v-col",{key:e.value,attrs:{cols:"12",md:"4",sm:"4"}},[s("v-checkbox",{attrs:{label:e.text,value:e.value,color:"primary","hide-details":""},model:{value:t.selectedColumns,callback:function(e){t.selectedColumns=e},expression:"selectedColumns"}})],1)})),1)],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"warning"},on:{click:function(){t.dialog=!1}}},[s("v-icon",{attrs:{left:""}},[t._v("mdi-close-box-multiple")]),t._v(" "+t._s(t.$t("App.hardcoded-texts.Close"))+" ")],1),s("v-btn",{attrs:{color:"warning"},on:{click:t.reset}},[s("v-icon",{attrs:{left:""}},[t._v("mdi-close-box-multiple")]),t._v(" "+t._s(t.$t("App.hardcoded-texts.Reset"))+" ")],1),s("v-btn",{attrs:{color:"primary"},on:{click:t.onFilter}},[s("v-icon",{attrs:{left:""}},[t._v("mdi-content-save-check-outline")]),t._v(" "+t._s(t.$t("App.hardcoded-texts.Apply"))+" ")],1)],1)],1)],1)],1)],1)},r=[],o=(s(6699),s(4972)),a=s(9669),l=s.n(a),n={name:"ihris-report",props:["reportData","label","terms","termsConditions","dataURL","page","hideCheckboxes","hideLabel"],data:function(){return{debug:"",downloading:!1,headers:[],allHeaders:[],results:[],selectedColumns:[],options:{itemsPerPage:10},loading:!1,total:0,prevPage:-1,link:[],selected:[],error_message:null,selectAll:!1,dialog:!1}},watch:{selected(){this.selected.length!==this.results.length&&this.selectAll&&(this.selectAll=!1),o.Y.$emit("ihris-report-selections",this.selected,this.reportData,this.terms,this.termsConditions,this.selectAll)},terms:{handler(){this.selectAll=!1,this.getTotalRecords(),this.getData(!0),o.Y.$emit("changedTerms",this.terms)},deep:!0},termsConditions:{handler(){Object.keys(this.terms).length>0&&(this.selectAll=!1,this.getTotalRecords(),this.getData(!0))},deep:!0},options:{handler(){this.getTotalRecords(),this.getData()},deep:!0}},computed:{itemsPerPage(){let t=[5,10,20,50];return t}},created:function(){this.reportData&&this.reportData.fieldsDetails&&this.reportData.fieldsDetails.sort(((t,e)=>null!=t[2]&&null==e[2]||null!=t[2]&&null!=e[2]&&t[2]<e[2]?-1:null!=e[2]&&null==t[2]||null!=t[2]&&null!=e[2]&&t[2]>e[2]?1:-1));for(let t of this.reportData.fieldsDetails)this.headers.push({text:t[0],value:t[1]}),this.allHeaders.push({text:t[0],value:t[1]});o.Y.$on("reload-report",(()=>{this.getTotalRecords(),this.getData()})),o.Y.$on("mhero-select-all",(()=>{this.selected=[],this.selected=this.results,this.selectAll=!0}))},methods:{reset(){this.headers=this.allHeaders,this.dialog=!1},onFilter(){this.dialog=!1,this.headers=this.allHeaders.filter((t=>{if(this.selectedColumns.includes(t.value))return t}))},clickIt:function(t){this.$router.push({name:"resource_view",params:{page:this.page,id:t.id}})},buildTerms(){let t,e={};if(e={query:{bool:{must:[],must_not:[]}}},Object.keys(this.terms).length>0)for(let s in this.terms){if(!this.terms[s]||0===this.terms[s].length)continue;let i;if(t=this.reportData.filters.find((t=>t.field===s)),t.isDropDown||(this.terms[s]=this.terms[s].replace(/\s+/g," ").trim()),i=t.isDropDown?s+".keyword":s,Array.isArray(this.terms[s])){let t={terms:{}};t.terms[i]=[];for(let e of this.terms[s])t.terms[i].push(e);"exclude"===this.termsConditions[s]?e.query.bool.must_not.push(t):e.query.bool.must.push(t)}else if(t.isDropDown){let t={terms:{}};t.terms[i]=[this.terms[s]],"exclude"===this.termsConditions[s]?e.query.bool.must_not.push(t):e.query.bool.must.push(t)}else{let t=this.terms[s].split(" ");for(let r of t){let t={};this.reportData.mappings.mappings.properties[i]&&"text"===this.reportData.mappings.mappings.properties[i].type?(t.wildcard={},t.wildcard[i]=r+"*"):(t.term={},t.term[i]=r),"exclude"===this.termsConditions[s]?e.query.bool.must_not.push(t):e.query.bool.must.push(t)}}}if(t&&t.field&&("startDate"==t.field||"endDate"==t.field)){let s,i=(new Date).toISOString().slice(0,10);"startDate"==t.field&&(s=this.terms.startDate),"endDate"==t.field&&(i=this.terms.endDate),e={query:{bool:{filter:[{range:{startDate:{gte:s}}},{range:{endDate:{lte:i}}}]}}}}return o.Y.$emit("builtESTerms",e),e},getTotalRecords(){let t=`/es/${this.reportData.indexName}/_count`,e=this.buildTerms();e.reportOptions={locationBasedConstraint:this.reportData.locationBasedConstraint},fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((t=>{t.json().then((t=>{this.total=t.count,o.Y.$emit("report-total-records",this.total)}))}))},getData(t){this.loading=!0,this.error_message=null;let e="";t&&(this.options.page=1);let s=this.options.itemsPerPage||10;-1===s&&(s=this.total);let i=this.options.page*this.options.itemsPerPage-this.options.itemsPerPage;e=`/es/${this.reportData.indexName}/_search?size=${s}&from=${i}`,this.prevPage=this.options.page;let r=this.buildTerms();r.reportOptions={locationBasedConstraint:!0};let o=[];for(let a in this.options.sortBy){let t,e=this.options.sortBy[a],s={};t=this.reportData.mappings.mappings.properties[e]&&"text"===this.reportData.mappings.mappings.properties[e].type?e+".keyword":e,this.options.sortDesc[a]?s[t]="desc":s[t]="asc",o.push(s)}r.sort=o,fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((t=>{t.json().then((t=>{if(this.results=[],t.hits.total.value>0){this.link=t.link;for(let e of t.hits.hits){let t={};for(let s in e["_source"])t[s]=e["_source"][s];t.id=e["_id"],this.results.push(t)}}this.selectAll&&(this.selected=this.results),this.loading=!1})).catch((t=>{this.loading=!1,this.error_message="Unable to load results.",console.log(t)}))})).catch((t=>{this.loading=!1,this.error_message="Unable to load results.",console.log(t)}))},reportExport(t){this.downloading=!0;let e=`/es/export/${t}/${this.reportData.indexName}`,s={query:this.buildTerms(),headers:this.headers,label:this.label,selected:this.selected};l()({url:e,method:"POST",responseType:"blob",data:s}).then((e=>{this.downloading=!1;let s=new Blob([e.data],{type:"text/csv"}),i=document.createElement("a");i.href=window.URL.createObjectURL(s),i.download=`${this.label}.${t}`,i.click()}))}}},c=n,d=s(3736),h=s(3453),p=s.n(h),u=s(3150),m=s(2371),g=s(7118),v=(s(2245),s(172)),f=s(8230),b=s(7764),x=b.Z.extend({name:"v-checkbox",props:{indeterminate:Boolean,indeterminateIcon:{type:String,default:"$checkboxIndeterminate"},offIcon:{type:String,default:"$checkboxOff"},onIcon:{type:String,default:"$checkboxOn"}},data(){return{inputIndeterminate:this.indeterminate}},computed:{classes(){return{...f.Z.options.computed.classes.call(this),"v-input--selection-controls":!0,"v-input--checkbox":!0,"v-input--indeterminate":this.inputIndeterminate}},computedIcon(){return this.inputIndeterminate?this.indeterminateIcon:this.isActive?this.onIcon:this.offIcon},validationState(){if(!this.isDisabled||this.inputIndeterminate)return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0}},watch:{indeterminate(t){this.$nextTick((()=>this.inputIndeterminate=t))},inputIndeterminate(t){this.$emit("update:indeterminate",t)},isActive(){this.indeterminate&&(this.inputIndeterminate=!1)}},methods:{genCheckbox(){const{title:t,...e}=this.attrs$;return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.$createElement(v.Z,this.setTextColor(this.validationState,{props:{dense:this.dense,dark:this.dark,light:this.light}}),this.computedIcon),this.genInput("checkbox",{...e,"aria-checked":this.inputIndeterminate?"mixed":this.isActive.toString()}),this.genRipple(this.setTextColor(this.rippleState))])},genDefaultSlot(){return[this.genCheckbox(),this.genLabel()]}}}),C=s(2102),_=s(4228),y=s(4998),D=s(4497),k=s(1418),w=s(6428),$=s(4470),I=s(624),T=s(2877),S=s(9762),A=(0,d.Z)(c,i,r,!1,null,null,null),P=A.exports;p()(A,{VBtn:u.Z,VCard:m.Z,VCardActions:g.h7,VCardSubtitle:g.Qq,VCardText:g.ZB,VCardTitle:g.EB,VCheckbox:x,VCol:C.Z,VContainer:_.Z,VDataTable:y.Z,VDialog:D.Z,VDivider:k.Z,VIcon:w.Z,VLayout:$.Z,VProgressCircular:I.Z,VRow:T.Z,VSpacer:S.Z})}}]);
//# sourceMappingURL=ihris-es-report.0ed5d8ac.js.map