"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[4322],{55533:function(e,t,i){i.d(t,{Z:function(){return r}});var s=i(48085),a=i(73325),r=(0,a.Z)(s.Z).extend({name:"v-subheader",props:{inset:Boolean},render(e){return e("div",{staticClass:"v-subheader",class:{"v-subheader--inset":this.inset,...this.themeClasses},attrs:this.$attrs,on:this.$listeners},this.$slots.default)}})},8258:function(e,t,i){i.r(t),i.d(t,{default:function(){return S}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-container",{staticClass:"mt-4"},[i("v-overlay",{attrs:{value:e.overlay}},[i("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"50"}})],1),i("v-navigation-drawer",{staticClass:"primary darken-1 white--text",staticStyle:{"z-index":"3"},attrs:{app:"",clipped:"",permanent:"",right:""}},[i("v-list",{staticClass:"white--text"},[e.practitioner?i("v-list-item",[i("v-btn",{staticClass:"primary",attrs:{dark:""},on:{click:function(t){return e.$router.push("/resource/view/student/"+e.practitioner)}}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-eye")]),i("span",[e._v("View Student")])],1)],1):e._e(),i("v-list-item",[i("v-btn",{staticClass:"success",attrs:{disabled:!e.canFinanceReview,dark:""},on:{click:function(t){e.approvalDialog=!0}}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-check-decagram")]),i("span",[e._v("Finance Director Review")])],1)],1),i("v-list-item",[i("v-btn",{staticClass:"success",attrs:{disabled:!e.canTaalimReview,dark:""},on:{click:function(t){e.approvalDialog=!0}}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-check-decagram")]),i("span",[e._v("Taalim Director Review")])],1)],1)],1)],1),i("v-dialog",{attrs:{persistent:"","max-width":"500px",transition:"dialog-transition"},model:{value:e.approvalDialog,callback:function(t){e.approvalDialog=t},expression:"approvalDialog"}},[i("v-card",[i("v-toolbar",{staticClass:"darken-1 white--text text-uppercase font-weight-bold",attrs:{color:"primary",dark:""}},[e._v(" Approve/Reject Registration "),i("v-spacer"),i("v-btn",{attrs:{icon:"",color:"white"},on:{click:function(t){e.approvalDialog=!1}}},[i("v-icon",[e._v("mdi-close")])],1)],1),i("v-card-text",[i("v-select",{staticClass:"ma-2",attrs:{items:e.statuses,label:"Status",outlined:"",dense:"","hide-details":"",clearable:""},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}})],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{color:"success",disabled:!e.status},on:{click:e.save}},[e._v("Save")])],1)],1)],1),i("fhir-page-view",{key:e.key,attrs:{id:e.queries.id,page:"itsf-registration-application",showDrawer:!1}})],1)},a=[],r={props:["queries"],data:function(){return{key:0,financeReview:{},taalimReview:{},taalimReviewId:"",financeReviewId:"",statusText:"",status:"",regStatus:"",statuses:[{text:"Approve",value:"approved"},{text:"Reject",value:"rejected"},{text:"Pending",value:"pending"}],payments:[],approvalDialog:!1,rows:{fake:!1},overlay:!1}},computed:{role(){let e=this.$store.state.user.obj.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-assign-role"===e.url)).valueReference.reference;return e.split("/")[1]},canFinanceReview(){return"approved"!=this.financeReview.code&&"itsf-admin-finance-role"===this.role},canTaalimReview(){return"approved"==this.financeReview.code&&"approved"!==this.taalimReview.code&&"itsf-taalim-role"===this.role}},methods:{getReviewStatuses(){return new Promise((e=>{fetch("/fhir/Basic/"+this.queries.id).then((t=>{t.json().then((t=>{this.taalimReview=t.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/taalim-status"===e.url))?.valueCoding,this.financeReview=t.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/finance-status"===e.url))?.valueCoding,this.practitioner=t.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-practitioner-reference"===e.url))?.valueReference?.reference,this.practitioner&&(this.practitioner=this.practitioner.split("/")[1]),this.financeReview||(this.financeReview={code:"pending"}),this.taalimReview||(this.taalimReview={code:"pending"}),this.financeReview&&"approved"!=this.financeReview?.code?this.status=this.financeReview.code:this.financeReview&&"pending"===this.financeReview?.code&&(this.statusText="Waiting Finance Director Approval"),"approved"==this.financeReview?.code&&"approved"!==this.taalimReview?.code?this.status=this.taalimReview.code:"pending"===this.taalimReview?.code&&(this.statusText="Waiting Finance Director Approval"),this.regStatus=this.status,e()})).catch((()=>{e()}))})).catch((()=>{e()}))}))},save(){this.overlay=!0,this.approvalDialog=!1;let e={status:this.status,id:this.queries.id,practitioner:this.queries.practitioner,role:this.role};fetch("/site/student/new_registration_approval",{method:"POST",headers:{"Content-Type":"application/json"},redirect:"manual",body:JSON.stringify(e)}).then((e=>{e.ok?(this.key+=1,this.getReviewStatuses().then((()=>{this.overlay=!1})),this.$store.commit("setMessage",{type:"success",text:"Registration Processed Successfully"})):this.$store.commit("setMessage",{type:"error",text:"Failed to process registration"})}))},hasTask(e){return this.$store.state.user.obj.permissions&&this.$store.state.user.obj.permissions.special&&this.$store.state.user.obj.permissions.special.special&&this.$store.state.user.obj.permissions.special.special.id&&this.$store.state.user.obj.permissions.special.special.id[e]}},created(){this.overlay=!0,this.getReviewStatuses().then((()=>{this.overlay=!1}))},components:{"fhir-page-view":()=>i.e(6851).then(i.bind(i,6851))}},n=r,o=i(43736),c=i(43453),l=i.n(c),v=i(63150),p=i(32371),h=i(37118),u=i(4228),d=i(4497),f=i(96428),m=i(16816),g=i(97620),w=i(65132),R=i(51058),b=i(90624),k=i(43986),x=i(99762),y=i(36656),C=(0,o.Z)(n,s,a,!1,null,null,null),S=C.exports;l()(C,{VBtn:v.Z,VCard:p.Z,VCardActions:h.h7,VCardText:h.ZB,VContainer:u.Z,VDialog:d.Z,VIcon:f.Z,VList:m.Z,VListItem:g.Z,VNavigationDrawer:w.Z,VOverlay:R.Z,VProgressCircular:b.Z,VSelect:k.Z,VSpacer:x.Z,VToolbar:y.Z})}}]);
//# sourceMappingURL=4322.0c78970f.js.map