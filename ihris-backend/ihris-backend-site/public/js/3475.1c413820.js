"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[3475],{2245:function(){},3702:function(e,t,s){s.d(t,{Z:function(){return n}});s(2245);var i=s(172),a=s(8230),r=s(7764),n=r.Z.extend({name:"v-checkbox",props:{indeterminate:Boolean,indeterminateIcon:{type:String,default:"$checkboxIndeterminate"},offIcon:{type:String,default:"$checkboxOff"},onIcon:{type:String,default:"$checkboxOn"}},data(){return{inputIndeterminate:this.indeterminate}},computed:{classes(){return{...a.Z.options.computed.classes.call(this),"v-input--selection-controls":!0,"v-input--checkbox":!0,"v-input--indeterminate":this.inputIndeterminate}},computedIcon(){return this.inputIndeterminate?this.indeterminateIcon:this.isActive?this.onIcon:this.offIcon},validationState(){if(!this.isDisabled||this.inputIndeterminate)return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0}},watch:{indeterminate(e){this.$nextTick((()=>this.inputIndeterminate=e))},inputIndeterminate(e){this.$emit("update:indeterminate",e)},isActive(){this.indeterminate&&(this.inputIndeterminate=!1)}},methods:{genCheckbox(){const{title:e,...t}=this.attrs$;return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.$createElement(i.Z,this.setTextColor(this.validationState,{props:{dense:this.dense,dark:this.dark,light:this.light}}),this.computedIcon),this.genInput("checkbox",{...t,"aria-checked":this.inputIndeterminate?"mixed":this.isActive.toString()}),this.genRipple(this.setTextColor(this.rippleState))])},genDefaultSlot(){return[this.genCheckbox(),this.genLabel()]}}})},3205:function(e,t,s){s.d(t,{Z:function(){return r}});var i=s(8085),a=s(3325),r=(0,a.Z)(i.Z).extend({name:"v-subheader",props:{inset:Boolean},render(e){return e("div",{staticClass:"v-subheader",class:{"v-subheader--inset":this.inset,...this.themeClasses},attrs:this.$attrs,on:this.$listeners},this.$slots.default)}})},9155:function(e,t,s){var i=s(6286),a=s(538);t["Z"]=a["default"].extend({name:"rippleable",directives:{ripple:i.Z},props:{ripple:{type:[Boolean,Object],default:!0}},methods:{genRipple(e={}){return this.ripple?(e.staticClass="v-input--selection-controls__ripple",e.directives=e.directives||[],e.directives.push({name:"ripple",value:{center:!0}}),this.$createElement("div",e)):null}}})},7764:function(e,t,s){s.d(t,{X:function(){return o}});var i=s(8230),a=s(9155),r=s(4419),n=s(3325);function o(e){e.preventDefault()}t["Z"]=(0,n.Z)(i.Z,a.Z,r.Z).extend({name:"selectable",model:{prop:"inputValue",event:"change"},props:{id:String,inputValue:null,falseValue:null,trueValue:null,multiple:{type:Boolean,default:null},label:String},data(){return{hasColor:this.inputValue,lazyValue:this.inputValue}},computed:{computedColor(){if(this.isActive)return this.color?this.color:this.isDark&&!this.appIsDark?"white":"primary"},isMultiple(){return!0===this.multiple||null===this.multiple&&Array.isArray(this.internalValue)},isActive(){const e=this.value,t=this.internalValue;return this.isMultiple?!!Array.isArray(t)&&t.some((t=>this.valueComparator(t,e))):void 0===this.trueValue||void 0===this.falseValue?e?this.valueComparator(e,t):Boolean(t):this.valueComparator(t,this.trueValue)},isDirty(){return this.isActive},rippleState(){return this.isDisabled||this.validationState?this.validationState:void 0}},watch:{inputValue(e){this.lazyValue=e,this.hasColor=e}},methods:{genLabel(){const e=i.Z.options.methods.genLabel.call(this);return e?(e.data.on={click:o},e):e},genInput(e,t){return this.$createElement("input",{attrs:Object.assign({"aria-checked":this.isActive.toString(),disabled:this.isDisabled,id:this.computedId,role:e,type:e},t),domProps:{value:this.value,checked:this.isActive},on:{blur:this.onBlur,change:this.onChange,focus:this.onFocus,keydown:this.onKeydown,click:o},ref:"input"})},onClick(e){this.onChange(),this.$emit("click",e)},onChange(){if(!this.isInteractive)return;const e=this.value;let t=this.internalValue;if(this.isMultiple){Array.isArray(t)||(t=[]);const s=t.length;t=t.filter((t=>!this.valueComparator(t,e))),t.length===s&&t.push(e)}else t=void 0!==this.trueValue&&void 0!==this.falseValue?this.valueComparator(t,this.trueValue)?this.falseValue:this.trueValue:e?this.valueComparator(t,e)?null:e:!t;this.validate(!0,t),this.internalValue=t,this.hasColor=t},onFocus(e){this.isFocused=!0,this.$emit("focus",e)},onBlur(e){this.isFocused=!1,this.$emit("blur",e)},onKeydown(e){}}})},3136:function(e,t,s){s.r(t),s.d(t,{default:function(){return P}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{attrs:{"grid-list-xs":""}},[s("v-overlay",{attrs:{value:e.overlay}},[s("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"50"}}),s("v-btn",{attrs:{icon:""},on:{click:function(t){e.overlay=!1}}},[s("v-icon",[e._v("mdi-close")])],1)],1),s("v-dialog",{attrs:{persistent:"","max-width":"500px",transition:"dialog-transition"},model:{value:e.approveResultsDialog,callback:function(t){e.approveResultsDialog=t},expression:"approveResultsDialog"}},[s("v-card",[s("v-toolbar",{staticClass:"darken-1 white--text text-uppercase font-weight-bold",attrs:{color:"primary",dark:""}},[e._v(" Confirm "),s("v-spacer"),s("v-btn",{attrs:{icon:"",color:"white"},on:{click:function(t){e.approveResultsDialog=!1}}},[s("v-icon",[e._v("mdi-close")])],1)],1),s("v-card-title",[e._v(" Are you sure you want to approve results? ")]),s("v-card-text",[s("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[s("v-text-field",e._g({attrs:{label:"Provide Registration Date*","prepend-icon":"mdi-event",readonly:"",outlined:"",dense:""},model:{value:e.registrationDateFormatted,callback:function(t){e.registrationDateFormatted=t},expression:"registrationDateFormatted"}},i))]}}]),model:{value:e.registrationDateMenu,callback:function(t){e.registrationDateMenu=t},expression:"registrationDateMenu"}},[s("v-date-picker",{on:{change:function(t){e.registrationDateFormatted=e.formatDate(e.registrationDate)},input:function(t){e.registrationDateMenu=!1}},model:{value:e.registrationDate,callback:function(t){e.registrationDate=t},expression:"registrationDate"}})],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"success",disabled:!e.registrationDate},on:{click:e.approveResults}},[s("v-icon",[e._v("mdi-check")]),e._v("Proceed")],1)],1)],1)],1),s("v-dialog",{attrs:{persistent:"","max-width":"1000px",transition:"dialog-transition"},model:{value:e.applicants.dialog,callback:function(t){e.$set(e.applicants,"dialog",t)},expression:"applicants.dialog"}},[s("v-card",[s("v-toolbar",{staticClass:"darken-1 white--text text-uppercase font-weight-bold",attrs:{color:"primary",dark:""}},["waitingexam"===e.applicantStatus?[e._v(" Select Applicants To Enroll ")]:e._e(),"failed"===e.applicantStatus?[e._v(" Enroll Retaking Candidates ")]:e._e(),s("v-spacer"),s("v-btn",{attrs:{icon:"",color:"white"},on:{click:function(t){e.applicants.dialog=!1}}},[s("v-icon",[e._v("mdi-close")])],1)],2),s("v-card-title",[s("v-text-field",{staticClass:"ma-2",attrs:{label:"Omang Number",dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.buildTerms("applicants")},"click:clear":function(t){return e.clearSearch("omang","applicants")}},model:{value:e.search.omang,callback:function(t){e.$set(e.search,"omang",t)},expression:"search.omang"}}),s("v-text-field",{staticClass:"ma-2",attrs:{label:"Passport Number",dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.buildTerms("applicants")},"click:clear":function(t){return e.clearSearch("passport","applicants")}},model:{value:e.search.passport,callback:function(t){e.$set(e.search,"passport",t)},expression:"search.passport"}})],1),e.applicants.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[e._v(e._s(e.applicants.error_message))]):e._e(),s("v-card-text",[e._v(" "+e._s(e.applicants.selected.length)+" Selected "),s("v-data-table",{staticClass:"elevation-1",staticStyle:{cursor:"pointer"},attrs:{headers:e.applicants.headers,items:e.applicants.results,"item-key":"id",options:e.applicants.options,"server-items-length":e.applicants.total,"footer-props":{"items-per-page-text":e.$t("App.hardcoded-texts.tableText"),"items-per-page-options":[5,10,20,50]},loading:e.applicants.loadingApplicants,"show-select":""},on:{"update:options":function(t){return e.$set(e.applicants,"options",t)}},model:{value:e.applicants.selected,callback:function(t){e.$set(e.applicants,"selected",t)},expression:"applicants.selected"}})],1),s("v-card-actions",[s("v-btn",{attrs:{color:"success",disabled:0===e.applicants.selected.length},on:{click:e.enroll}},[e._v("Enroll Selected")])],1)],1)],1),s("v-card",{staticClass:"mx-auto",attrs:{"max-width":"900",outlined:""}},[s("v-card-title",{staticClass:"primary darken-1 white--text text-uppercase font-weight-bold"},[e._v(" NMCB Scheduled Exam ")]),s("v-card-text",{staticClass:"my-3"},[s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("v-btn",{attrs:{disabled:!e.canEnroll,color:"secondary",dark:"",small:""},on:{click:function(t){return e.getApplicants(!0,"waitingexam")}}},[s("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-playlist-check")]),s("span",[e._v("Enroll Candidates")])],1),s("br"),s("br"),s("v-btn",{attrs:{disabled:!e.canEnroll,color:"secondary",dark:"",small:""},on:{click:function(t){return e.getApplicants(!0,"failed")}}},[s("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-playlist-check")]),s("span",[e._v("Enroll Retaking Candidates")])],1),s("br"),s("br"),s("v-btn",{attrs:{disabled:!e.canApproveResults,color:"success",dark:"",small:""},on:{click:function(t){e.approveResultsDialog=!0}}},[s("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-check")]),s("span",[e._v("Approve Resultss")])],1)],1),s("v-divider",{attrs:{vertical:""}}),s("v-col",{attrs:{cols:"8"}},[s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Cadres Categories:")])]),s("v-col",{attrs:{cols:"8"}},e._l(e.exam.cadres,(function(t,i){return s("v-chip",{key:i,staticClass:"ma-2"},[e._v(" "+e._s(t.display)+" ")])})),1)],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Assessments:")])]),s("v-col",{attrs:{cols:"8"}},e._l(e.exam.assessments,(function(t,i){return s("v-chip",{key:i,staticClass:"ma-2"},[e._v(" "+e._s(t.display)+" ")])})),1)],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Pass Mark:")])]),s("v-col",{attrs:{cols:"8"}},[e._v(e._s(e.exam.passmark))])],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Start Date:")])]),s("v-col",{attrs:{cols:"8"}},[e._v(e._s(e.exam.startdate))])],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("End Date:")])]),s("v-col",{attrs:{cols:"8"}},[e._v(e._s(e.exam.enddate))])],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Description:")])]),s("v-col",{attrs:{cols:"8"}},[e._v(e._s(e.exam.desciption))])],1),s("v-divider"),s("v-row",{staticClass:"justify-space-between"},[s("v-col",{attrs:{cols:"4"}},[s("span",{staticClass:"font-weight-bold"},[e._v("Status:")])]),s("v-col",{attrs:{cols:"8"}},[e._v(e._s(e.exam.status.display))])],1)],1)],1)],1)],1),s("br"),s("v-card",[s("v-card-title",[e._v(" Enrolled Applicants "),s("v-spacer"),s("v-btn",{attrs:{color:"error",small:"",disabled:0===e.applicants.selected.length||!e.hasTask("exam.exam-scheduling")},on:{click:e.unenroll}},[s("v-icon",{attrs:{left:""}},[e._v("mdi-close-outline")]),e._v("Un Enroll Selected ")],1),s("v-spacer"),!e.resultsMode&&e.hasTask("nmcb-practitioner-exam-profile")?s("v-btn",{attrs:{color:"primary"},on:{click:e.activateAddResults}},[e.exam&&e.exam.status&&"approved"===e.exam.status.code?[e._v(" View Results ")]:[e._v(" Add Results ")]],2):e.hasTask("nmcb-practitioner-exam-profile")?[s("v-btn",{attrs:{color:"success",disabled:e.exam&&e.exam.status&&"approved"===e.exam.status.code},on:{click:e.saveResults}},[e._v("Save Results")]),e._v("     "),s("v-btn",{attrs:{color:"primary"},on:{click:e.deactivateAddResults}},[e._v("Hide Results")])]:e._e()],2),s("v-card-title",[s("v-text-field",{staticClass:"ma-2",attrs:{label:"Omang Number",dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.buildTerms("enrolled")},"click:clear":function(t){return e.clearSearch("omang","enrolled")}},model:{value:e.search.omang,callback:function(t){e.$set(e.search,"omang",t)},expression:"search.omang"}}),s("v-text-field",{staticClass:"ma-2",attrs:{label:"Passport Number",dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.buildTerms("enrolled")},"click:clear":function(t){return e.clearSearch("passport","enrolled")}},model:{value:e.search.passport,callback:function(t){e.$set(e.search,"passport",t)},expression:"search.passport"}})],1),e.enrolled.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[e._v(e._s(e.enrolled.error_message))]):e._e(),s("v-card-text",[s("v-data-table",{staticClass:"elevation-1",staticStyle:{cursor:"pointer"},attrs:{headers:e.enrolled.headers,items:e.enrolled.results,"item-key":"id",options:e.enrolled.options,"server-items-length":e.enrolled.total,"footer-props":{"items-per-page-text":e.$t("App.hardcoded-texts.tableText"),"items-per-page-options":[5,10,20,50]},loading:e.enrolled.loadingEnrolled,"show-select":""},on:{"update:options":function(t){return e.$set(e.enrolled,"options",t)}},scopedSlots:e._u([{key:"item",fn:function(t){var i=t.item;return[s("tr",{on:{click:function(t){return e.clickIt(i)}}},[s("td",[s("v-checkbox",{attrs:{color:"red",value:i,"hide-details":""},on:{click:function(e){e.stopPropagation()}},model:{value:e.applicants.selected,callback:function(t){e.$set(e.applicants,"selected",t)},expression:"applicants.selected"}})],1),s("td",[e._v(e._s(i.surname))]),s("td",[e._v(e._s(i.given))]),s("td",[e._v(e._s(i.birthDate))]),s("td",[e._v(e._s(i.gender))]),s("td",[e._v(e._s(i.omang[0]))]),s("td",[e._v(e._s(i.passport[0]))]),s("td",[e._v(e._s(i.cadreCategory))]),s("td",[e._v(e._s(i.location))]),e.resultsMode?[e._l(e.exam.assessments,(function(t){return s("td",{key:i.id+t.code},[s("v-text-field",{attrs:{readonly:e.exam&&e.exam.status&&"approved"===e.exam.status.code,"error-messages":e.examResults[i.examId][t.code].errors,outlined:"","hide-details":"auto",dense:""},on:{click:function(e){e.stopPropagation()},input:function(t){return e.validateScore(i.examId)}},model:{value:e.examResults[i.examId][t.code].score,callback:function(s){e.$set(e.examResults[i.examId][t.code],"score",s)},expression:"examResults[item.examId][assessment.code].score"}})],1)})),s("td",["Pass"===e.examResults[i.examId]["exam-assessment"]?s("v-chip",{attrs:{dark:"",color:"green"}},[e._v(" "+e._s(e.examResults[i.examId]["exam-assessment"])+" ")]):e._e(),"Fail"===e.examResults[i.examId]["exam-assessment"]?s("v-chip",{attrs:{dark:"",color:"red"}},[e._v(" "+e._s(e.examResults[i.examId]["exam-assessment"])+" ")]):e._e()],1)]:e._e()],2)]}}]),model:{value:e.applicants.selected,callback:function(t){e.$set(e.applicants,"selected",t)},expression:"applicants.selected"}})],1)],1)],1)},a=[],r=(s(6699),{props:["queries"],data(){return{overlay:!1,resultsMode:!1,approveResultsDialog:!1,registrationDate:"",registrationDateFormatted:"",registrationDateMenu:!1,exam:{cadres:[],assessments:[],status:{}},examResults:{},search:{name:"",omang:"",passport:""},enrolled:{options:{itemsPerPage:5},total:0,prevPage:-1,link:[],terms:{},results:[],headers:[{text:"Surname",value:"surname"},{text:"Given Name(s)",value:"given"},{text:"Birth Date",value:"birthDate"},{text:"Gender",value:"gender"},{text:"OMANG",value:"omang"},{text:"Passport",value:"passport"},{text:"Cadre Category",value:"cadreCategory"},{text:"Training Location",value:"location"}],loadingEnrolled:!1,update_again:{rerun:!1,restart:!1},error_message:null},applicants:{selected:[],dialog:!1,options:{itemsPerPage:2},total:0,prevPage:-1,link:[],terms:{},results:[],headers:[{text:"Surname",value:"surname"},{text:"Given Name(s)",value:"given"},{text:"Birth Date",value:"birthDate"},{text:"Gender",value:"gender"},{text:"OMANG",value:"omang"},{text:"Passport",value:"passport"},{text:"Cadre Category",value:"cadreCategory"},{text:"Training Location",value:"location"},{text:"Attempts",value:"attempt"}],loadingApplicants:!1,update_again:{rerun:!1,restart:!1},error_message:null},applicantStatus:""}},watch:{"applicants.options":{handler(){this.getApplicants()},deep:!0},"enrolled.options":{handler(){this.getEnrolled()},deep:!0}},computed:{canEnroll(){return!!this.hasTask("exam.exam-scheduling")&&((!this.exam||!this.exam.status||"approved"!==this.exam.status.code)&&!this.$moment(this.exam.enddate).isBefore(this.$moment().format("YYYY-MM-DD")))},canApproveResults(){return!!this.hasTask("nmcb-approves-exam-results")&&(!this.exam||!this.exam.status||"approved"!==this.exam.status.code)}},methods:{formatDate(e){if(!e)return null;const[t,s,i]=e.split("-");return`${i}-${s}-${t}`},selectAll(){this.applicants.selected=this.applicants.selected.concat(this.applicants.results)},unselectDisabled(e){if(e.disabled){let t=this.applicants.selected.findIndex((t=>t.id===e.id));t>-1&&this.applicants.selected.splice(t,1)}},approveResults(){if(!this.hasTask("nmcb-practitioner-exam-profile"))return;this.approveResultsDialog=!1,this.overlay=!0;let e={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify({exam:this.queries.exam,registrationDate:this.registrationDate})};fetch("/site/nmcb/approveResults",e).then((e=>{this.overlay=!1,200===e.status?(this.$store.commit("setMessage",{type:"success",text:"Results approved successfully"}),this.getExam(),this.getEnrolled()):this.$store.commit("setMessage",{type:"error",text:"Failed to generate registrations for some few applicants, try again."})})).catch((()=>{this.overlay=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to generate registrations for some few applicants, try again."})}))},clickIt:function(e){this.$router.push({path:"/custom/nmcb-registration-application?id="+e.application+"&practitioner="+e.id+"&path=/components/nmcb/"})},validateScore(e){let t=0,s=!1,i=!0;for(let a of this.exam.assessments){this.examResults[e][a.code].errors=[];let r=this.examResults[e][a.code].score;if(r&&r.toString().split(".").length>1&&!r.toString().split(".")[1]&&(this.examResults[e][a.code].errors=["Incomplete number"],s=!0),isNaN(r)){this.examResults[e][a.code].errors=["Must be a number"],s=!0;break}r?t+=parseFloat(r):i=!1,t>100&&(this.examResults[e][a.code].errors=["Total Exceeds 100"],s=!0)}s||!i?this.examResults[e]["exam-assessment"]="":this.exam.passmark>t?this.examResults[e]["exam-assessment"]="Fail":this.exam.passmark<=t&&(this.examResults[e]["exam-assessment"]="Pass")},activateAddResults(){this.resultsMode=!0;for(let e of this.exam.assessments)this.enrolled.headers.push({text:e.display,value:e.code});this.enrolled.headers.push({text:"Assessment",value:"exam-assessment"})},deactivateAddResults(){this.resultsMode=!1;for(let t of this.exam.assessments){let e=this.enrolled.headers.findIndex((e=>e.value===t.code));this.enrolled.headers.splice(e,1)}let e=this.enrolled.headers.findIndex((e=>"exam-assessment"===e.value));this.enrolled.headers.splice(e,1)},saveResults(){if(!this.hasTask("nmcb-practitioner-exam-profile"))return;this.overlay=!0;let e={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify(this.examResults)};fetch("/site/nmcb/saveResults",e).then((e=>{this.overlay=!1,200===e.status?this.$store.commit("setMessage",{type:"success",text:"Results saved successfully"}):this.$store.commit("setMessage",{type:"error",text:"Failed to save results."})})).catch((()=>{this.overlay=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to save results."})}))},enroll(){this.applicants.dialog=!1,this.overlay=!0;let e={resourceType:"Bundle",type:"transaction",entry:[]};for(let s of this.applicants.selected){let t={resourceType:"Basic",meta:{profile:["http://ihris.org/fhir/StructureDefinition/nmcb-practitioner-exam-profile"]},extension:[{url:"http://ihris.org/fhir/StructureDefinition/exam-attempt",valueInteger:s.attempt+1},{url:"http://ihris.org/fhir/StructureDefinition/ihris-practitioner-reference",valueReference:{reference:"Practitioner/"+s.id}},{url:"http://ihris.org/fhir/StructureDefinition/nmcb-registration-application-reference",valueReference:{reference:"Basic/"+s.application}},{url:"http://ihris.org/fhir/StructureDefinition/nmcb-exam-scheduling-reference",valueReference:{reference:"Basic/"+this.queries.exam}}]};e.entry.push({resource:t,request:{method:"POST",url:"Basic"}})}let t={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify(e)};fetch("/site/nmcb/enrollApplicants",t).then((e=>{this.applicants.selected=[],this.overlay=!1,201===e.status||200===e.status?(this.getEnrolled(),this.$store.commit("setMessage",{type:"success",text:"Applicants Enrolled Successfully"})):this.$store.commit("setMessage",{type:"error",text:"Failed to enroll applicants."})})).catch((()=>{this.applicants.selected=[],this.overlay=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to enroll applicants."})}))},unenroll(){this.overlay=!0;let e={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify({applicants:this.applicants.selected,exam:this.queries.exam})};fetch("/site/nmcb/unenrollApplicants",e).then((e=>{this.overlay=!1,this.applicants.selected=[],201===e.status||200===e.status?(this.getEnrolled(),this.$store.commit("setMessage",{type:"success",text:"Applicants Un Enrolled Successfully"})):this.$store.commit("setMessage",{type:"error",text:"Failed to un enroll applicants."})})).catch((()=>{this.applicants.selected=[],this.overlay=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to un enroll applicants."})}))},getExam(){fetch("/fhir/Basic/"+this.queries.exam).then((e=>{e.json().then((e=>{let t=e.extension.filter((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-cadre-category"===e.url));this.exam.cadres=[];for(let r of t)this.exam.cadres.push({code:r.valueCoding.code,display:r.valueCoding.display});let s=e.extension.filter((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-exam-assessment-type"===e.url));this.exam.assessments=[];for(let r of s)this.exam.assessments.push({code:r.valueCoding.code,display:r.valueCoding.display});this.exam.passmark=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-exam-passmark"===e.url)).valueDecimal,this.exam.startdate=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/start-date"===e.url)).valueDate,this.exam.enddate=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/end-date"===e.url)).valueDate;let i=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/comments"===e.url));i&&(this.exam.desciption=i.valueString);let a=e.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-examresults-status"===e.url));a&&(this.exam.status=a.valueCoding)}))}))},clearSearch:function(e,t){this.search[e]="",this[t].terms.practitioner="",this.buildTerms(t)},checkRerunApplicants(){!this.applicants.loadingApplicants&&this.applicants.update_again.rerun&&(this.getApplicants(this.applicants.update_again.restart),this.applicants.update_again={rerun:!1,restart:!1})},checkRerunEnrolled(){!this.enrolled.loadingEnrolled&&this.enrolled.update_again.rerun&&(this.getEnrolled(this.enrolled.update_again.restart),this.enrolled.update_again={rerun:!1,restart:!1})},async buildTerms(e){"applicants"===e?(this.applicants.terms={},await this.getDataPractitioner(e),this.getApplicants(!0)):"enrolled"===e&&(this.enrolled.terms={},await this.getDataPractitioner(e),this.getEnrolled(!0))},getDataPractitioner(e){return new Promise(((t,s)=>{let i="";if(this.search.omang&&(i="?identifier="+this.search.omang),this.search.passport&&(i?i+="&identifier="+this.search.passport:i="?identifier="+this.search.passport),!i)return t();let a="/fhir/Practitioner"+i;fetch(a).then((i=>{i.json().then((async s=>{let i=[];if(s.entry&&s.entry.length>0)for(let e of s.entry)i.push("Practitioner/"+e.resource.id);i.length>0?this[e].terms["practitioner"]=i.join(","):this[e].terms["practitioner"]="Practitioner/fakeprct",t()})).catch((()=>{s()}))})).catch((()=>{s()}))}))},getApplicants(e,t){if(t&&(this.applicantStatus=t),this.applicants.dialog||(this.applicants.selected=[]),this.applicants.dialog=!0,this.applicants.loadingApplicants)return this.applicants.update_again.rerun=!0,void(this.applicants.update_again.restart=this.applicants.update_again.restart||e);this.applicants.loadingApplicants=!0,this.applicants.error_message=null;let s="";for(let r of this.exam.cadres)s?s+=","+r.code:s=r.code;let i="";if(e&&(this.applicants.options.page=1),this.applicants.options.page>1&&(this.applicants.options.page===this.applicants.prevPage-1?i=this.applicants.link.find((e=>"previous"===e.relation)).url:this.applicants.options.page===this.applicants.prevPage+1&&(i=this.applicants.link.find((e=>"next"===e.relation)).url),i=i.replace(/_getpages=[^&]*&*/,"").replace("/fhir?","/fhir/Basic?"),i=i.substring(i.indexOf("/fhir/")),-1===i.indexOf("_profile=http://ihris.org/fhir/StructureDefinition/nmcb-registration-application-profile")&&(i+="&_profile=http://ihris.org/fhir/StructureDefinition/nmcb-registration-application-profile"),-1===i.indexOf("nmcbapplicationstatus="+this.applicantStatus)&&(i=i+"&nmcbapplicationstatus="+this.applicantStatus),-1===i.indexOf("nmcbcadrecategory:includes="+s)&&(i=i+"&nmcbcadrecategory:includes="+s),-1===i.indexOf("_revinclude=Basic:nmcbapplication")&&(i+="&_revinclude=Basic:nmcbapplication"),-1===i.indexOf("_include=Basic:practitioner")&&(i+="&_include=Basic:practitioner"),-1===i.indexOf("_sort=-_lastUpdated")&&(i+="&_sort=-_lastUpdated"),-1===i.indexOf("_total=accurate")&&(i+="&_total=accurate")),""===i){let e=this.applicants.options.itemsPerPage,t="";for(let s in this.applicants.options.sortBy)t&&(t+=","),this.applicants.options.sortDesc[s]&&(t+="-"),t+=this.applicants.options.sortBy[s];i="/fhir/Basic?_profile=http://ihris.org/fhir/StructureDefinition/nmcb-registration-application-profile&nmcbapplicationstatus="+this.applicantStatus+"&nmcbcadrecategory:includes="+s+"&_revinclude=Basic:nmcbapplication&_include=Basic:practitioner&_count="+e+"&_sort=-_lastUpdated&_total=accurate"}let a=Object.keys(this.applicants.terms);for(let r of a)Array.isArray(this.applicants.terms[r])?this.applicants.terms[r].length>0&&(i+="&"+r+"="+this.applicants.terms[r].join(",")):this.applicants.terms[r]&&(i+="&"+r+"="+this.applicants.terms[r]);this.applicants.prevPage=this.applicants.options.page,fetch(i).then((e=>{e.json().then((async e=>{if(this.applicants.results=[],e.total>0){this.applicants.link=e.link;for(let t of e.entry){if("Practitioner"!==t.resource.resourceType)continue;let s={id:t.resource.id};s.surname=t.resource.name[0].family,s.given=t.resource.name[0].given.join(", "),s.birthDate=t.resource.birthDate,s.gender=t.resource.gender,s.gender=await this.$fhirutils.lookup(s.gender,"http://hl7.org/fhir/administrative-gender"),s.omang=this.$fhirpath.evaluate(t.resource,"Practitioner.identifier.where(type.coding.code='omang').value"),s.passport=this.$fhirpath.evaluate(t.resource,"Practitioner.identifier.where(type.coding.code='passport').value");let i=e.entry.filter((e=>e.resource.meta.profile.includes("http://ihris.org/fhir/StructureDefinition/nmcb-practitioner-exam-profile")&&e.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-practitioner-reference"===e.url&&e.valueReference.reference==="Practitioner/"+s.id))));if(i){let e;for(let t of i){if(e=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-exam-scheduling-reference"===e.url&&e.valueReference.reference==="Basic/"+this.queries.exam)),e)break;let i=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/exam-attempt"===e.url));i&&(!s.attempt||s.attempt<i.valueInteger)&&(s.attempt=i.valueInteger)}if(e)continue;if(s.attempt>=5)continue;s.attempt||(s.attempt=0)}let a=!1;for(let t of e.entry){if(!t.resource.meta.profile.includes("http://ihris.org/fhir/StructureDefinition/nmcb-registration-application-profile"))continue;let i=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-practitioner-reference"===e.url))?.valueReference?.reference;if("Practitioner/"+s.id!==i)continue;a=e.entry.find((e=>e.resource.meta.profile.includes("http://ihris.org/fhir/StructureDefinition/nmcb-practitioner-exam-profile")&&e.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-registration-application-reference"===e.url)).valueReference.reference==="Basic/"+t.resource.id));let r=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-cadre-category"===e.url))?.valueCoding;r&&(s.cadreCategory=r.display);let n=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-training-location"===e.url))?.valueCoding;n&&(s.location=n.display),s.application=t.resource.id}a||this.applicants.results.push(s)}}this.applicants.total=e.total,this.applicants.loadingApplicants=!1,this.checkRerunApplicants()})).catch((e=>{this.applicants.loadingApplicants=!1,this.applicants.error_message="Unable to load results.",this.checkRerunApplicants(),console.log(e)}))})).catch((e=>{this.applicants.loadingApplicants=!1,this.applicants.error_message="Unable to load results.",this.checkRerunApplicants(),console.log(e)}))},getEnrolled(e){if(this.enrolled.selected=[],this.enrolled.dialog=!0,this.enrolled.loadingEnrolled)return this.enrolled.update_again.rerun=!0,void(this.enrolled.update_again.restart=this.enrolled.update_again.restart||e);this.enrolled.loadingEnrolled=!0,this.enrolled.error_message=null;let t="";if(e&&(this.enrolled.options.page=1),this.enrolled.options.page>1&&(this.enrolled.options.page===this.enrolled.prevPage-1?t=this.enrolled.link.find((e=>"previous"===e.relation)).url:this.enrolled.options.page===this.enrolled.prevPage+1&&(t=this.enrolled.link.find((e=>"next"===e.relation)).url),t=t.replace(/_getpages=[^&]*&*/,"").replace("/fhir?","/fhir/Basic?"),t=t.substring(t.indexOf("/fhir/")),-1===t.indexOf("_profile=http://ihris.org/fhir/StructureDefinition/nmcb-practitioner-exam-profile")&&(t+="&_profile=http://ihris.org/fhir/StructureDefinition/nmcb-practitioner-exam-profile"),-1===t.indexOf("nmcbscheduledexam=Basic/"+this.queries.exam)&&(t=t+"&nmcbscheduledexam=Basic/"+this.queries.exam),-1===t.indexOf("_include=Basic:practitioner")&&(t+="&_include=Basic:practitioner"),-1===t.indexOf("_sort=-_lastUpdated")&&(t+="&_sort=-_lastUpdated"),-1===t.indexOf("_total=accurate")&&(t+="&_total=accurate")),""===t){let e=this.enrolled.options.itemsPerPage,s="";for(let t in this.enrolled.options.sortBy)s&&(s+=","),this.enrolled.options.sortDesc[t]&&(s+="-"),s+=this.enrolled.options.sortBy[t];t="/fhir/Basic?_profile=http://ihris.org/fhir/StructureDefinition/nmcb-practitioner-exam-profile&nmcbscheduledexam=Basic/"+this.queries.exam+"&_include=Basic:nmcbapplication&_include=Basic:practitioner&_count="+e+"&_sort=-_lastUpdated&_total=accurate"}let s=Object.keys(this.enrolled.terms);for(let i of s)Array.isArray(this.enrolled.terms[i])?this.enrolled.terms[i].length>0&&(t+="&"+i+"="+this.enrolled.terms[i].join(",")):this.enrolled.terms[i]&&(t+="&"+i+"="+this.enrolled.terms[i]);this.enrolled.prevPage=this.enrolled.options.page,fetch(t).then((e=>{e.json().then((async e=>{if(this.enrolled.results=[],e.total>0){this.enrolled.link=e.link;for(let t of e.entry){if("Practitioner"!==t.resource.resourceType)continue;let s={id:t.resource.id};s.surname=t.resource.name[0].family,s.given=t.resource.name[0].given.join(", "),s.birthDate=t.resource.birthDate,s.gender=t.resource.gender,s.gender=await this.$fhirutils.lookup(s.gender,"http://hl7.org/fhir/administrative-gender"),s.omang=this.$fhirpath.evaluate(t.resource,"Practitioner.identifier.where(type.coding.code='omang').value"),s.passport=this.$fhirpath.evaluate(t.resource,"Practitioner.identifier.where(type.coding.code='passport').value");for(let t of e.entry){if(!t.resource.extension)continue;let e=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-practitioner-reference"===e.url))?.valueReference?.reference;if("Practitioner/"+s.id!==e)continue;if(t.resource.meta.profile.includes("http://ihris.org/fhir/StructureDefinition/nmcb-practitioner-exam-profile")){this.examResults[t.resource.id]||this.$set(this.examResults,t.resource.id,{}),s.examId=t.resource.id;for(let s of this.exam.assessments){let e="";for(let i of t.resource.extension)if(i.url==="http://ihris.org/fhir/StructureDefinition/"+s.code+"-score"){e=i.valueDecimal;break}e&&!this.examResults[t.resource.id][s.code]?this.$set(this.examResults[t.resource.id],s.code,{score:e,errors:[]}):e||this.examResults[t.resource.id][s.code]||this.$set(this.examResults[t.resource.id],s.code,{score:"",errors:[]})}let e=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/exam-assessment"===e.url));e&&!this.examResults[t.resource.id]["exam-assessment"]?this.$set(this.examResults[t.resource.id],"exam-assessment",e.valueCoding.display):e||this.examResults[t.resource.id]["exam-assessment"]||this.$set(this.examResults[t.resource.id],"exam-assessment","")}if(!t.resource.meta.profile.includes("http://ihris.org/fhir/StructureDefinition/nmcb-registration-application-profile"))continue;let i=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-cadre-category"===e.url))?.valueCoding;i&&(s.cadreCategory=i.display);let a=t.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/nmcb-training-location"===e.url))?.valueCoding;a&&(s.location=a.display),s.application=t.resource.id}this.enrolled.results.push(s)}}this.enrolled.total=e.total,this.enrolled.loadingEnrolled=!1,this.checkRerunEnrolled()})).catch((e=>{this.enrolled.loadingEnrolled=!1,this.enrolled.error_message="Unable to load results.",this.checkRerunEnrolled(),console.log(e)}))})).catch((e=>{this.enrolled.loadingEnrolled=!1,this.enrolled.error_message="Unable to load results.",this.checkRerun(),console.log(e)}))},hasTask(e){return this.$store.state.user.obj.permissions&&this.$store.state.user.obj.permissions.special&&this.$store.state.user.obj.permissions.special.special&&this.$store.state.user.obj.permissions.special.special.id&&this.$store.state.user.obj.permissions.special.special.id[e]||this.$store.state.user.obj.permissions&&this.$store.state.user.obj.permissions.special&&this.$store.state.user.obj.permissions.special.navigation&&this.$store.state.user.obj.permissions.special.navigation.id&&this.$store.state.user.obj.permissions.special.navigation.id[e]}},created(){this.getExam(),this.getEnrolled()}}),n=r,o=s(3736),l=s(3453),c=s.n(l),p=s(3150),u=s(2371),d=s(7118),h=s(3702),m=s(5424),f=s(2102),v=s(4228),g=s(4998),x=s(9771),b=s(4497),y=s(1418),_=s(6428),k=s(1152),D=s(1058),S=s(624),C=s(2877),R=s(9762),$=s(5978),w=s(6656),A=(0,o.Z)(n,i,a,!1,null,null,null),P=A.exports;c()(A,{VBtn:p.Z,VCard:u.Z,VCardActions:d.h7,VCardSubtitle:d.Qq,VCardText:d.ZB,VCardTitle:d.EB,VCheckbox:h.Z,VChip:m.Z,VCol:f.Z,VContainer:v.Z,VDataTable:g.Z,VDatePicker:x.Z,VDialog:b.Z,VDivider:y.Z,VIcon:_.Z,VMenu:k.Z,VOverlay:D.Z,VProgressCircular:S.Z,VRow:C.Z,VSpacer:R.Z,VTextField:$.Z,VToolbar:w.Z})}}]);
//# sourceMappingURL=3475.1c413820.js.map