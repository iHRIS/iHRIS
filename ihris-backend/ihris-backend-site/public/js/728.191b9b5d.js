"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[728],{60728:function(e,i,t){t.r(i),t.d(i,{default:function(){return y}});var s=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("v-container",{key:e.pageKey,staticClass:"my-3"},[t("v-form",{ref:"form",model:{value:e.valid,callback:function(i){e.valid=i},expression:"valid"}},[e._t("default",null,{source:e.source}),t("v-overlay",{attrs:{value:e.overlay}},[t("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"50"}})],1)],2)],1)},r=[],l=(t(26699),{name:"ihris-resource",props:["title","field","fhir-id","page","profile","section-menu","edit","links","constraints"],data:function(){return{fhir:{},orig:{},valid:!0,source:{data:{},path:""},path:"",loading:!1,overlay:!1,isEdit:!1,linktext:[],position:"",advancedValid:!0,loadingId:!1,loadingCv:!1,version:1,max:1,pageKey:0,rules:{min:e=>e>=1||"The Min is 1",max:e=>e<=this.max||`The Max is ${this.max}`}}},created:function(){if(this.fhirId)this.loading=!0,fetch("/fhir/"+this.field+"/"+this.fhirId).then((e=>{e.json().then((e=>{this.max=e.meta.versionId,this.orig=e,this.source={data:e,path:this.field},this.setLinkText(),this.loading=!1})).catch((e=>{console.log(this.field,this.fhirId,e)}))})).catch((e=>{console.log(this.field,this.fhirId,e)}));else if(this.$route.query){let i={resourceType:this.field},t=!1;for(let s of Object.keys(this.$route.query))if(s.startsWith(this.field+".")){t=!0;let r=s.substring(this.field.length+1).split("."),l=r.pop(),a=i;for(let i of r)if(i.includes("["))try{let e=i.split("["),t=e[0],s=e[1].slice(0,-1);if(a.hasOwnProperty(t)||(a[t]=[]),s){let e={};a[t][parseInt(s)]=e,a=e}else{let e={};a[t].push(e),a=e}}catch(e){console.log("Unable to process",s)}else a.hasOwnProperty(i)||(a[i]={},a=a[i]);if(l.includes("["))try{let e=l.split("["),i=e[0],t=e[1].slice(0,-1);a.hasOwnProperty(i)||(a[i]=[]),t?a[i][parseInt(t)]=this.$route.query[s]:a[i].push(this.$route.query[s])}catch(e){console.log("Unable to process",s)}else a[l]=this.$route.query[s]}t&&(this.source={data:i,path:this.field})}},computed:{hasFhirId:function(){return""!=this.fhirId&&!!this.fhirId}},methods:{getLinkField:function(e){let i=this.$fhirpath.evaluate(this.source.data,e);return!!i&&i[0]},getLinkUrl:function(e){let i;if(e.field&&(i=this.getLinkField(e.field)),i){if(i.includes("/")){let e=i.split("/");i=e[1]}return e.url.replace("FIELD",i)}return e.url},setLinkText:function(){for(let e in this.links){let i=this.links[e];if(i.text)this.linktext[e]=i.text;else if(i.field){let t=this.getLinkField(i.field);t&&this.$fhirutils.lookup(t).then((i=>{this.$set(this.linktext,e,i)}))}}},processFHIR:async function(){if(this.$refs.form.validate(),!this.valid)return;this.advancedValid=!0,this.overlay=!0,this.loading=!0;const e=async(i,t,s)=>{for(let l of s){let s=i,a=t;if(l.field&&!l.fieldType){let e;if(l.sliceName?l.field.startsWith("value[x]")?(e=l.field.substring(9),s+="."+e):(e=l.field.replace(":"+l.sliceName,""),s+="."+e):(e=l.field,s+="."+e),"1"!==l.max||"1"!==l.baseMax?t.hasOwnProperty(e)||(a[e]=[]):a[e]={},l.hasOwnProperty("value"))Array.isArray(a[e])?a[e].push(l.value):a[e]=l.value,a=a[e];else if(Array.isArray(a[e])){let i={};l.profile?i.url=l.profile:"extension"===e&&l.sliceName&&(i.url=l.sliceName),a[e].push(i),a=i}else a=a[e]}if(l.$children)try{await e(s,a,l.$children)}catch(r){this.advancedValid=!1,console.log(r)}if(l.constraints){l.errors=[];try{this.advancedValid=this.advancedValid&&await this.$fhirutils.checkConstraints(l.constraints,this.constraints,a,l.errors,this.fhirId)}catch(r){this.advancedValid=!1,l.errors.push("An unknown error occurred."),console.log(r)}}}};this.fhir={resourceType:this.field,meta:{profile:[this.profile]}};try{await e(this.field,this.fhir,this.$children)}catch(s){this.advancedValid=!1,console.log(s)}if(!this.advancedValid)return this.overlay=!1,this.loading=!1,void this.$store.commit("setMessage",{type:"error",text:"There were errors on the form."});console.log("FINISHED PROCESS AND CHECK.");let i="/fhir/"+this.field,t={method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual"};this.fhirId&&(this.fhir.id=this.fhirId,i+="/"+this.fhirId,t.method="PUT"),t.body=JSON.stringify(this.fhir),fetch(i,t).then((e=>{201!==e.status&&200!==e.status||e.json().then((e=>{this.overlay=!1,this.loading=!1,this.fhirId?(this.$store.commit("setMessage",{type:"success",text:"Update successful."}),setTimeout((()=>this.$router.go(0)),1e3)):this.$router.push({name:"resource_view",params:{page:this.page,id:e.id}})}))}))}}}),a=l,h=t(43736),o=t(43453),n=t.n(o),d=t(4228),c=t(46232),f=t(51058),u=t(90624),p=(0,h.Z)(a,s,r,!1,null,null,null),y=p.exports;n()(p,{VContainer:d.Z,VForm:c.Z,VOverlay:f.Z,VProgressCircular:u.Z})}}]);
//# sourceMappingURL=728.191b9b5d.js.map