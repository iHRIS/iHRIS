"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[4319],{55533:function(e,t,i){i.d(t,{Z:function(){return a}});var s=i(48085),r=i(73325),a=(0,r.Z)(s.Z).extend({name:"v-subheader",props:{inset:Boolean},render(e){return e("div",{staticClass:"v-subheader",class:{"v-subheader--inset":this.inset,...this.themeClasses},attrs:this.$attrs,on:this.$listeners},this.$slots.default)}})},59965:function(e,t,i){i.r(t),i.d(t,{default:function(){return x}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-container",{staticClass:"mt-4"},[i("v-overlay",{attrs:{value:e.overlay}},[i("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"50"}})],1),i("v-navigation-drawer",{staticClass:"primary darken-1 white--text",staticStyle:{"z-index":"3"},attrs:{app:"",clipped:"",permanent:"",right:""}},[i("v-list",{staticClass:"white--text"},[i("v-list-item",[i("v-btn",{staticClass:"primary",attrs:{dark:""},on:{click:function(t){return e.$router.push("/resource/view/student/"+e.queries.practitioner)}}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-eye")]),i("span",[e._v("View Student")])],1)],1),i("v-list-item",[i("v-btn",{staticClass:"success",attrs:{disabled:!e.canFinanceReview,dark:""},on:{click:function(t){e.approvalDialog=!0}}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-check-decagram")]),i("span",[e._v("Finance Director Review")])],1)],1),i("v-list-item",[i("v-btn",{staticClass:"success",attrs:{disabled:!e.canTaalimReview,dark:""},on:{click:function(t){e.approvalDialog=!0}}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-check-decagram")]),i("span",[e._v("Taalim Director Review")])],1)],1),i("v-list-item",[i("v-btn",{staticClass:"success",attrs:{disabled:!e.hasTask("can-edit-registration"),dark:""},on:{click:function(t){return e.$router.push("/custom/edit_registration?path=/itsf&id="+e.queries.role+"&practitioner="+e.queries.practitioner)}}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-eye")]),i("span",[e._v("Edit")])],1)],1),i("v-list-item",[i("v-btn",{staticClass:"success",attrs:{disabled:!e.canPrintId,dark:""},on:{click:e.printid}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-eye")]),i("span",[e._v("Print ID")])],1)],1),i("v-list-item",[i("v-btn",{staticClass:"success",attrs:{dark:""},on:{click:function(t){return e.$router.push("/questionnaire/itsf-school-fees-payments/feespayments?practitionerrole="+e.queries.role)}}},[i("v-icon",{attrs:{light:"",left:""}},[e._v("mdi-contactless-payment-circle-outline")]),i("span",[e._v("Pay Fees")])],1)],1)],1)],1),i("v-dialog",{attrs:{persistent:"","max-width":"500px",transition:"dialog-transition"},model:{value:e.approvalDialog,callback:function(t){e.approvalDialog=t},expression:"approvalDialog"}},[i("v-card",[i("v-toolbar",{staticClass:"darken-1 white--text text-uppercase font-weight-bold",attrs:{color:"primary",dark:""}},[e._v(" Approve/Reject Registration "),i("v-spacer"),i("v-btn",{attrs:{icon:"",color:"white"},on:{click:function(t){e.approvalDialog=!1}}},[i("v-icon",[e._v("mdi-close")])],1)],1),i("v-card-text",[i("v-select",{staticClass:"ma-2",attrs:{items:e.statuses,label:"Status",outlined:"",dense:"","hide-details":"",clearable:""},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}})],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{color:"success",disabled:!e.status},on:{click:e.save}},[e._v("Save")])],1)],1)],1),i("fhir-page-view",{attrs:{id:e.queries.role,page:"practitionerrole",showDrawer:!1},on:{"templates-loaded":e.registrationPageLoaded}}),i("v-row",[e._l(e.payments,(function(t,s){return i("v-col",{key:s,attrs:{cols:"12"}},[i("v-btn",{attrs:{color:"success"},on:{click:function(i){return e.$router.push("/custom/edit_fees?path=/itsf&id="+t+"&practitioner="+e.queries.practitioner+"&role="+e.queries.role)}}},[e._v("Edit Below Fee")]),e.rows[t]?i("fhir-page-view",{attrs:{id:t,page:"feespayments",showDrawer:!1},on:{"templates-loaded":function(t){return e.feesTemplateLoaded(s)}}}):e._e()],1)})),i("v-col",{attrs:{cols:"12"}},[e.financeReviewPage?i("fhir-page-view",{attrs:{id:e.financeReviewId,page:"finance-review",showDrawer:!1},on:{"templates-loaded":function(t){e.taalimReviewPage=!0}}}):e._e()],1),i("v-col",{attrs:{cols:"12"}},[e.taalimReviewPage?i("fhir-page-view",{attrs:{id:e.taalimReviewId,page:"taalim-review",showDrawer:!1}}):e._e()],1)],2)],1)},r=[],a=(i(26699),{props:["queries"],data:function(){return{financeReview:{},taalimReview:{},taalimReviewId:"",financeReviewId:"",taalimReviewPage:!1,financeReviewPage:!1,statusText:"",status:"",regStatus:"",statuses:[{text:"Approve",value:"approved"},{text:"Reject",value:"rejected"},{text:"Pending",value:"pending"}],displaySecond:!1,payments:[],approvalDialog:!1,rows:{fake:!1},overlay:!1,familyHeadInactive:!0,registrationDisplayed:!1}},computed:{role(){let e=this.$store.state.user.obj.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/ihris-assign-role"===e.url)).valueReference.reference;return e.split("/")[1]},canApprove(){return!this.familyHeadInactive&&"approved"!=this.regStatus},canFinanceReview(){return!this.familyHeadInactive&&"approved"!=this.financeReview.code&&"itsf-admin-finance-role"===this.role},canTaalimReview(){return!this.familyHeadInactive&&"approved"==this.financeReview.code&&"approved"!==this.taalimReview.code&&"itsf-taalim-role"===this.role},canPrintId(){return"approved"==this.financeReview.code&&"approved"===this.taalimReview.code&&"itsf-id-card-manager"===this.role}},methods:{registrationPageLoaded(){this.rows[this.payments[0]]||(this.rows[this.payments[0]]=!0),this.registrationDisplayed=!0},feesTemplateLoaded(e){1==this.payments.length||this.payments.length===e+1?this.financeReviewPage=!0:this.rows[this.payments[e+1]]=!0},getPayment(){return new Promise((e=>{fetch("/fhir/Basic?_elements=id&registrationfeespayment=PractitionerRole/"+this.queries.role).then((t=>{t.json().then((t=>{if(t.entry){for(let e of t.entry)this.payments.push(e.resource.id),this.$set(this.rows,e.resource.id,!1);this.registrationDisplayed&&(this.rows[this.payments[0]]=!0)}e()})).catch((()=>{e()}))})).catch((()=>{e()}))}))},getReviewStatuses(){return new Promise((e=>{fetch("/fhir/Basic?registrationreference=PractitionerRole/"+this.queries.role+"&_profile=http://ihris.org/fhir/StructureDefinition/taalim-registration-review-profile,http://ihris.org/fhir/StructureDefinition/finance-registration-review-profile").then((t=>{t.json().then((t=>{let i=t.entry.find((e=>e.resource.meta.profile.includes("http://ihris.org/fhir/StructureDefinition/finance-registration-review-profile"))),s=t.entry.find((e=>e.resource.meta.profile.includes("http://ihris.org/fhir/StructureDefinition/taalim-registration-review-profile")));i&&(this.financeReviewId=i.resource.id,this.financeReview=i.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/registration-status"===e.url))?.valueCoding),s&&(this.taalimReviewId=s.resource.id,this.taalimReview=s.resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/registration-status"===e.url))?.valueCoding),this.familyHeadInactive||"approved"==this.financeReview.code?"pending"===this.financeReview.code&&(this.statusText="Waiting Finance Director Approval"):this.status=this.financeReview.code,this.familyHeadInactive||"approved"!=this.financeReview.code||"approved"===this.taalimReview.code?"pending"===this.taalimReview.code&&(this.statusText="Waiting Finance Director Approval"):this.status=this.taalimReview.code,this.regStatus=this.status,e()})).catch((()=>{e()}))})).catch((()=>{e()}))}))},getFamilyHead(){return new Promise((e=>{let t="/fhir/Basic?_profile=http://ihris.org/fhir/StructureDefinition/itsf-family-head-profile&practitioner=Practitioner/"+this.queries.practitioner+"&familymemberactive=yes";fetch(t).then((t=>{t.json().then((t=>{if(t.entry){let e=t.entry[0].resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/family-head"===e.url))?.valueReference?.reference;if(e){let t={resource:"PractitionerRole",params:{practitioner:"Practitioner/"+e.split("/")[1]}};fetch("/site/student/getLatestResourceById/",{method:"POST",headers:{"Content-Type":"application/json"},redirect:"manual",body:JSON.stringify(t)}).then((e=>{e.ok?e.json().then((e=>{if(e.entry.length){let t=e.entry[0].resource.extension.find((e=>"http://ihris.org/fhir/StructureDefinition/registration-status"===e.url))?.valueCoding?.code;this.familyHeadInactive="approved"!==t}})):this.familyHeadInactive=!0}))}}else this.familyHeadInactive=!1;e()})).catch((()=>{e()}))})).catch((()=>{e()}))}))},save(){let e={status:this.status,practitionerrole:this.queries.role,practitioner:this.queries.practitioner,role:this.role};fetch("/site/student/registration_approval",{method:"POST",headers:{"Content-Type":"application/json"},redirect:"manual",body:JSON.stringify(e)}).then((e=>{e.ok?(this.$store.commit("setMessage",{type:"success",text:"Registration Processed Successfully"}),this.$router.push("/resource/view/student/"+this.queries.practitioner)):this.$store.commit("setMessage",{type:"error",text:"Failed to process registration"})}))},printid(){this.overlay=!0,fetch("/site/student/printId/"+this.queries.practitioner).then((e=>{e.blob().then((e=>{fetch("/fhir/Practitioner/"+this.queries.practitioner).then((t=>{t.json().then((t=>{this.overlay=!1;let i="",s=t.name.find((e=>{e.use}));!s&&t.name&&t.name.length>0&&(s=t.name[0]),s&&(s.given&&(i&&(i+=" "),i+=s.given.join(" ")),s.family&&(i&&(i+=" "),i+=s.family));let r=document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=`${i}.pdf`,r.click()})).catch((()=>{this.overlay=!1}))})).catch((()=>{this.overlay=!1}))})).catch((()=>{this.overlay=!1}))})).catch((()=>{this.overlay=!1}))},hasTask(e){return this.$store.state.user.obj.permissions&&this.$store.state.user.obj.permissions.special&&this.$store.state.user.obj.permissions.special.special&&this.$store.state.user.obj.permissions.special.special.id&&this.$store.state.user.obj.permissions.special.special.id[e]}},created(){this.overlay=!0,Promise.all([this.getPayment(),this.getFamilyHead(),this.getReviewStatuses()]).then((()=>{this.overlay=!1}))},components:{"fhir-page-view":()=>i.e(6851).then(i.bind(i,6851))}}),n=a,o=i(43736),c=i(43453),l=i.n(c),h=i(63150),d=i(32371),p=i(37118),u=i(82102),v=i(4228),f=i(4497),m=i(96428),g=i(16816),w=i(97620),y=i(65132),R=i(51058),b=i(90624),k=i(62877),D=i(43986),_=i(99762),P=i(36656),S=(0,o.Z)(n,s,r,!1,null,null,null),x=S.exports;l()(S,{VBtn:h.Z,VCard:d.Z,VCardActions:p.h7,VCardText:p.ZB,VCol:u.Z,VContainer:v.Z,VDialog:f.Z,VIcon:m.Z,VList:g.Z,VListItem:w.Z,VNavigationDrawer:y.Z,VOverlay:R.Z,VProgressCircular:b.Z,VRow:k.Z,VSelect:D.Z,VSpacer:_.Z,VToolbar:P.Z})}}]);
//# sourceMappingURL=4319.4ce56a4e.js.map