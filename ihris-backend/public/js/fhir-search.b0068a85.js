"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[242],{9664:function(e,t,s){s.r(t),s.d(t,{default:function(){return Z}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{staticClass:"py-5"},[s("v-card",{staticClass:"py-4 px-2"},[e.hideLabel?e._e():s("v-card-title",{staticClass:"ma-4"},[s("v-layout",{attrs:{row:"",wrap:""}},[e._v(" "+e._s(e.label)+" "),s("v-spacer"),s("v-row",{staticClass:"pr-4",attrs:{align:"center",justify:"end"}},[s("v-btn",{staticClass:"mr-2",attrs:{color:"primary"},on:{click:function(){e.dialog=!0}}},[s("v-icon",{attrs:{left:""}},[e._v("mdi-chart-box-plus-outline")]),e._v(" Customize Report ")],1),s("v-btn",{attrs:{color:"info"},on:{click:function(t){return e.reportExport("csv")}}},[e.downloading?s("v-progress-circular",{attrs:{color:"amber",indeterminate:""}}):s("v-icon",{attrs:{left:""}},[e._v("mdi-microsoft-excel")]),e._v(" Export ")],1)],1)],1)],1),s("v-divider",{staticClass:"my-2"}),e.hideLabel?e._e():s("v-card-title",[e._t("default")],2),e.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[e._v(e._s(e.error_message)+" ")]):e._e(),s("v-data-table",{staticClass:"elevation-1 mt-3",staticStyle:{cursor:"pointer"},attrs:{"footer-props":{"items-per-page-options":e.itemsPerPage},headers:e.headers,items:e.results,loading:e.loading,options:e.options,"server-items-length":e.total,"show-select":e.reportData.displayCheckbox&&!e.hideCheckboxes,"item-key":"id"},on:{"update:options":function(t){e.options=t}},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1),s("v-row",{attrs:{justify:"center"}},[s("v-dialog",{attrs:{"max-width":"80%",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",{staticClass:"px-6 py-4"},[s("v-card-title",{staticClass:"justify-center"},[s("span",{staticClass:"text-h6"},[s("v-icon",{staticClass:"mr-2",attrs:{color:"primary",large:""}},[e._v("mdi-table-check")]),e._v("Select a Field You want on the report")],1)]),s("v-card-text",[s("v-container",{attrs:{fluid:""}},[s("v-row",e._l(e.allHeaders,(function(t){return s("v-col",{key:t.value,attrs:{cols:"12",md:"4",sm:"4"}},[s("v-checkbox",{attrs:{label:t.text,value:t.value,color:"primary","hide-details":""},model:{value:e.selectedColumns,callback:function(t){e.selectedColumns=t},expression:"selectedColumns"}})],1)})),1)],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"warning"},on:{click:function(){e.dialog=!1}}},[s("v-icon",{attrs:{left:""}},[e._v("mdi-close-box-multiple")]),e._v(" Close ")],1),s("v-btn",{attrs:{color:"warning"},on:{click:e.reset}},[s("v-icon",{attrs:{left:""}},[e._v("mdi-close-box-multiple")]),e._v(" Reset ")],1),s("v-btn",{attrs:{color:"primary"},on:{click:e.onFilter}},[s("v-icon",{attrs:{left:""}},[e._v("mdi-content-save-check-outline")]),e._v(" Apply Changes ")],1)],1)],1)],1)],1)],1)},r=[],a=(s(6699),s(3212)),o=s(9669),l=s.n(o),n={name:"ihris-report",props:["reportData","label","terms","termsConditions","dataURL","page","hideCheckboxes","hideLabel"],data:function(){return{debug:"",downloading:!1,headers:[],allHeaders:[],results:[],selectedColumns:[],options:{itemsPerPage:10},loading:!1,total:0,prevPage:-1,link:[],selected:[],error_message:null,selectAll:!1,dialog:!1}},watch:{selected(){this.selected.length!==this.results.length&&this.selectAll&&(this.selectAll=!1),a.Y.$emit("ihris-report-selections",this.selected,this.reportData,this.terms,this.termsConditions,this.selectAll)},terms:{handler(){this.selectAll=!1,this.getTotalRecords(),this.getData(!0),a.Y.$emit("changedTerms",this.terms)},deep:!0},termsConditions:{handler(){Object.keys(this.terms).length>0&&(this.selectAll=!1,this.getTotalRecords(),this.getData(!0))},deep:!0},options:{handler(){this.getTotalRecords(),this.getData()},deep:!0}},computed:{itemsPerPage(){let e=[5,10,20,50];return e}},created:function(){for(let e of this.reportData.fieldsDetails)this.headers.push({text:e[0],value:e[1]}),this.allHeaders.push({text:e[0],value:e[1]});a.Y.$on("reload-report",(()=>{this.getTotalRecords(),this.getData()})),a.Y.$on("mhero-select-all",(()=>{this.selected=[],this.selected=this.results,this.selectAll=!0}))},methods:{reset(){this.headers=this.allHeaders,this.dialog=!1},onFilter(){this.dialog=!1,this.headers=this.allHeaders.filter((e=>{if(this.selectedColumns.includes(e.value))return e}))},clickIt:function(e){this.$router.push({name:"resource_view",params:{page:this.page,id:e.id}})},buildTerms(){let e,t={};if(t={query:{bool:{must:[],must_not:[]}}},Object.keys(this.terms).length>0)for(let s in this.terms){if(!this.terms[s]||0===this.terms[s].length)continue;let i;if(e=this.reportData.filters.find((e=>e.field===s)),e.isDropDown||(this.terms[s]=this.terms[s].replace(/\s+/g," ").trim()),i=e.isDropDown?s+".keyword":s,Array.isArray(this.terms[s])){let e={terms:{}};e.terms[i]=[];for(let t of this.terms[s])e.terms[i].push(t);"exclude"===this.termsConditions[s]?t.query.bool.must_not.push(e):t.query.bool.must.push(e)}else if(e.isDropDown){let e={terms:{}};e.terms[i]=[this.terms[s]],"exclude"===this.termsConditions[s]?t.query.bool.must_not.push(e):t.query.bool.must.push(e)}else{let e=this.terms[s].split(" ");for(let r of e){let e={};this.reportData.mappings.mappings.properties[i]&&"text"===this.reportData.mappings.mappings.properties[i].type?(e.wildcard={},e.wildcard[i]=r+"*"):(e.term={},e.term[i]=r),"exclude"===this.termsConditions[s]?t.query.bool.must_not.push(e):t.query.bool.must.push(e)}}}if(e&&e.field&&("startDate"==e.field||"endDate"==e.field)){let s,i=(new Date).toISOString().slice(0,10);"startDate"==e.field&&(s=this.terms.startDate),"endDate"==e.field&&(i=this.terms.endDate),t={query:{bool:{filter:[{range:{startDate:{gte:s}}},{range:{endDate:{lte:i}}}]}}}}return a.Y.$emit("builtESTerms",t),t},getTotalRecords(){let e=`/es/${this.reportData.indexName}/_count`,t=this.buildTerms();t.reportOptions={locationBasedConstraint:this.reportData.locationBasedConstraint},fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{e.json().then((e=>{this.total=e.count,a.Y.$emit("report-total-records",this.total)}))}))},getData(e){this.loading=!0,this.error_message=null;let t="";e&&(this.options.page=1);let s=this.options.itemsPerPage||10;-1===s&&(s=this.total);let i=this.options.page*this.options.itemsPerPage-this.options.itemsPerPage;t=`/es/${this.reportData.indexName}/_search?size=${s}&from=${i}`,this.prevPage=this.options.page;let r=this.buildTerms();r.reportOptions={locationBasedConstraint:!0};let a=[];for(let o in this.options.sortBy){let e,t=this.options.sortBy[o],s={};e=this.reportData.mappings.mappings.properties[t]&&"text"===this.reportData.mappings.mappings.properties[t].type?t+".keyword":t,this.options.sortDesc[o]?s[e]="desc":s[e]="asc",a.push(s)}r.sort=a,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>{e.json().then((e=>{if(this.results=[],e.hits.total.value>0){this.link=e.link;for(let t of e.hits.hits){let e={};for(let s in t["_source"])e[s]=t["_source"][s];e.id=t["_id"],this.results.push(e)}}this.selectAll&&(this.selected=this.results),this.loading=!1})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))},reportExport(e){this.downloading=!0;let t=`/es/export/${e}/${this.reportData.indexName}`,s={query:this.buildTerms(),headers:this.headers,label:this.label,selected:this.selected};l()({url:t,method:"POST",responseType:"blob",data:s}).then((t=>{this.downloading=!1;let s=new Blob([t.data],{type:"text/csv"}),i=document.createElement("a");i.href=window.URL.createObjectURL(s),i.download=`${this.label}.${e}`,i.click()}))}}},c=n,h=s(3736),d=s(3453),u=s.n(d),p=s(3150),m=s(2371),g=s(7118),f=(s(2245),s(172)),v=s(8230),b=s(7764),_=b.Z.extend({name:"v-checkbox",props:{indeterminate:Boolean,indeterminateIcon:{type:String,default:"$checkboxIndeterminate"},offIcon:{type:String,default:"$checkboxOff"},onIcon:{type:String,default:"$checkboxOn"}},data(){return{inputIndeterminate:this.indeterminate}},computed:{classes(){return{...v.Z.options.computed.classes.call(this),"v-input--selection-controls":!0,"v-input--checkbox":!0,"v-input--indeterminate":this.inputIndeterminate}},computedIcon(){return this.inputIndeterminate?this.indeterminateIcon:this.isActive?this.onIcon:this.offIcon},validationState(){if(!this.isDisabled||this.inputIndeterminate)return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0}},watch:{indeterminate(e){this.$nextTick((()=>this.inputIndeterminate=e))},inputIndeterminate(e){this.$emit("update:indeterminate",e)},isActive(){this.indeterminate&&(this.inputIndeterminate=!1)}},methods:{genCheckbox(){const{title:e,...t}=this.attrs$;return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.$createElement(f.Z,this.setTextColor(this.validationState,{props:{dense:this.dense,dark:this.dark,light:this.light}}),this.computedIcon),this.genInput("checkbox",{...t,"aria-checked":this.inputIndeterminate?"mixed":this.isActive.toString()}),this.genRipple(this.setTextColor(this.rippleState))])},genDefaultSlot(){return[this.genCheckbox(),this.genLabel()]}}}),y=s(2102),x=s(4228),k=s(6957),C=s(4497),D=s(1418),$=s(6428),T=s(4470),S=s(624),w=s(2877),V=s(9762),A=(0,h.Z)(c,i,r,!1,null,null,null),Z=A.exports;u()(A,{VBtn:p.Z,VCard:m.Z,VCardActions:g.h7,VCardSubtitle:g.Qq,VCardText:g.ZB,VCardTitle:g.EB,VCheckbox:_,VCol:y.Z,VContainer:x.Z,VDataTable:k.Z,VDialog:C.Z,VDivider:D.Z,VIcon:$.Z,VLayout:T.Z,VProgressCircular:S.Z,VRow:w.Z,VSpacer:V.Z})},2252:function(e,t,s){s.r(t),s.d(t,{default:function(){return b}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("label",[e.isDropDown&&!e.hideFilters?s("v-autocomplete",{staticClass:"ma-1",attrs:{loading:e.loading,label:e.label,items:e.items,outlined:"","error-messages":e.err_messages,error:e.error,clearable:"","hide-details":"","small-chips":"",dense:"",multiple:"","item-text":"display","item-value":"code"},on:{change:function(t){return e.updateSearch()},"click:clear":function(t){return e.clearSearch()}},scopedSlots:e._u([{key:"prepend-item",fn:function(){return[s("v-radio-group",{attrs:{row:""},on:{change:function(t){return e.updateSearch()}},model:{value:e.filterType,callback:function(t){e.filterType=t},expression:"filterType"}},[s("v-radio",{attrs:{label:"Include",value:"include"}}),s("v-radio",{attrs:{label:"Exclude",value:"exclude"}})],1),s("v-divider")]},proxy:!0}],null,!1,1071381286),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}):e.hideFilters?e._e():["date"==e.filterDataType?[s("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,r=t.attrs;return[s("v-text-field",e._g(e._b({staticClass:"ma-1",attrs:{label:e.label,readonly:"",clearable:"",dense:"",outlined:"","hide-details":""},on:{input:e.updateSearch},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},"v-text-field",r,!1),i))]}}],null,!1,3224575583),model:{value:e.dateMenu,callback:function(t){e.dateMenu=t},expression:"dateMenu"}},[s("v-date-picker",{ref:"picker",attrs:{max:(new Date).toISOString().substr(0,10),min:"1950-01-01"},on:{change:e.updateSearch},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)]:s("v-text-field",{staticClass:"ma-1",attrs:{"prepend-inner-icon":"mdi-filter-variant",label:e.label,dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.updateSearch()},"click:clear":function(t){return e.clearSearch()}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})]],2)},r=[],a={name:"ihris-search-term",props:["label","expression","isDropDown","reportData","hideFilters"],data:function(){return{loading:!1,items:[],error:!1,err_messages:null,filterType:"include",value:null,filterDataType:"",dateMenu:!1}},mounted:function(){if(this.reportData.mappings.mappings.properties[this.expression]&&(this.filterDataType=this.reportData.mappings.mappings.properties[this.expression].type),this.isDropDown&&this.filterDataType){this.loading=!0;let e=`/es/populateFilter/${this.reportData.indexName}/${this.expression}?dataType=${this.filterDataType}`;fetch(e,{method:"GET"}).then((e=>{e.json().then((e=>{this.loading=!1;for(let t of e)this.items.push(t.key.value)})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))}},methods:{updateSearch:function(){this.$emit("termChange",this.expression,this.value,this.filterType)},clearSearch:function(){this.$emit("termChange",this.expression,[])}},watch:{dateMenu(e){e&&setTimeout((()=>this.$refs.picker.activePicker="YEAR"))}}},o=a,l=s(3736),n=s(3453),c=s.n(n),h=s(1835),d=s(9771),u=s(1418),p=s(1152),m=s(8978),g=s(4739),f=s(5978),v=(0,l.Z)(o,i,r,!1,null,null,null),b=v.exports;c()(v,{VAutocomplete:h.Z,VDatePicker:d.Z,VDivider:u.Z,VMenu:p.Z,VRadio:m.Z,VRadioGroup:g.Z,VTextField:f.Z})},7108:function(e,t,s){s.r(t),s.d(t,{default:function(){return v}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{staticClass:"py-5"},[s("v-card",[s("v-card-title",[e._v(" "+e._s(e.label)+" "),s("v-spacer"),e._t("default")],2),e.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[e._v(e._s(e.error_message))]):e._e(),s("v-data-table",{staticClass:"elevation-1",staticStyle:{cursor:"pointer"},attrs:{headers:e.headers,items:e.results,options:e.options,"server-items-length":e.total,"footer-props":{"items-per-page-options":[5,10,20,50]},loading:e.loading,"show-select":e.reportData.displayCheckbox},on:{"update:options":function(t){e.options=t},"click:row":e.clickIt},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)],1)},r=[],a=s(3212),o={name:"ihris-report",props:["profile","reportData","label","terms","dataURL","page"],data:function(){return{debug:"",headers:[],results:[],options:{itemsPerPage:10},loading:!1,total:0,prevPage:-1,link:[],selected:[],error_message:null}},watch:{selected(){a.Y.$emit("ihris-report-selections",this.selected,this.reportData)},terms:{handler(){this.getData(!0)},deep:!0},options:{handler(){this.getData()},deep:!0}},created:function(){for(let e of this.reportData.fieldsDetails)for(let t of e.fields){let s=e.resourceType+"."+t[1];this.headers.push({text:t[0],value:s})}a.Y.$on("reload-report",(()=>{this.getData()}))},mounted:function(){this.getData(!0)},methods:{clickIt:function(e){this.$router.push({name:"resource_view",params:{page:this.page,id:e.id}})},getData(e){this.loading=!0,this.error_message=null;let t="";if(e&&(this.options.page=1),this.options.page>1&&(this.options.page===this.prevPage-1?t=this.link.find((e=>"previous"===e.relation)).url:this.options.page===this.prevPage+1&&(t=this.link.find((e=>"next"===e.relation)).url),t=t.substring(t.indexOf("/fhir/"))),""===t){let e=this.options.itemsPerPage||10,s="";for(let t in this.options.sortBy)s&&(s+=","),this.options.sortDesc[t]&&(s+="-"),s+=this.options.sortBy[t];t="/fhir/"+this.dataURL+"_count="+e+"&_total=accurate";let i=Object.keys(this.terms);for(let r of i)t+="&"+r+"="+this.terms[r];this.debug=t}this.prevPage=this.options.page,fetch(t).then((e=>{e.json().then((e=>{if(this.results=[],e.total>0){this.link=e.link;for(let t of e.entry){let e=[];if(t.resource.resourceType!==this.reportData.primaryResource){let s=this.reportData.resourcesConnections.find((e=>e.resourceType===t.resource.resourceType)),i=this.$fhirpath.evaluate(t.resource,s.linkElement.replace(s.resourceType+".",""));if(Array.isArray(i))for(let e in i)2!==i[e].split("/").length&&(i[e]=s.resourceType+"/"+i[e]);else-1===i.indexOf(s.resourceType+"/")&&(i=s.resourceType+"/"+i);for(let t in this.results){let r=this.results[t][s.linkTo];if(Array.isArray(r)&&Array.isArray(i)){let s=r.some((e=>i.indexOf(e)>=0));s&&e.push(t)}else(Array.isArray(r)&&-1!==r.indexOf(i)||Array.isArray(i)&&-1!==i.indexOf(r)||r===i)&&e.push(t)}}else{let s=this.results.push({id:t.resource.id});e.push(s-1)}let s=this.reportData.fieldsDetails.find((e=>e.resourceType===t.resource.resourceType));for(let i of s.fields){let r=s.resourceType+"."+i[1];for(let s of e)this.results[s][r]?this.results[s][r]+=", "+this.$fhirpath.evaluate(t.resource,r):this.results[s][r]=this.$fhirpath.evaluate(t.resource,r)}if(s.hiddenFields&&Array.isArray(s.hiddenFields))for(let i of s.hiddenFields){let s=i[1].split("."),r=this.$fhirpath.evaluate(t.resource,i[1]);"id"===s[s.length-1]&&(r=s[0]+"/"+r);for(let t of e)this.results[t][i[1]]=r}}}this.total=e.total,this.loading=!1})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))}}},l=o,n=s(3736),c=s(3453),h=s.n(c),d=s(2371),u=s(7118),p=s(4228),m=s(6957),g=s(9762),f=(0,n.Z)(l,i,r,!1,null,null,null),v=f.exports;h()(f,{VCard:d.Z,VCardSubtitle:u.Qq,VCardTitle:u.EB,VContainer:p.Z,VDataTable:m.Z,VSpacer:g.Z})},509:function(e,t,s){s.r(t),s.d(t,{default:function(){return _}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{staticClass:"py-5"},[s("v-card",[s("v-card-title",[e._v(" "+e._s(e.$t("App.ihris-search-code."+e.label))+" "),s("v-spacer"),e._t("default"),s("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:e.$t("App.ihris-search-code.search"),"single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),s("v-spacer"),s("v-btn",{class:e.addLink&&e.addLink.class||"primary",attrs:{to:e.addLink?e.addLink.url:"/resource/add/"+e.page}},[e.addLink&&e.addLink.icon?s("v-icon",[e._v(e._s(e.addLink.icon))]):s("v-icon",[e._v("mdi-database-plus")]),e._v(" "+e._s(e.$t("App.ihris-search-code.add"))+" "+e._s(e.$t("App.ihris-search-code."+e.label))+" ")],1)],2),e.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[e._v(e._s(e.error_message))]):e._e(),s("v-data-table",{staticClass:"elevation-1",staticStyle:{cursor:"pointer","z-index":"-1"},attrs:{headers:e.headers,items:e.results,"item-key":"code",search:e.search,options:e.options,"footer-props":{"items-per-page-text":e.$t("App.ihris-search.tableText"),"items-per-page-options":[5,10,20,50]},loading:e.loading},on:{"update:options":function(t){e.options=t},"click:row":e.clickIt},scopedSlots:e._u([{key:"item.isActive",fn:function(t){var i=t.item;return[i.code.includes("(deactivated)")?s("v-btn",{staticClass:"white--text text-none",attrs:{small:"",color:"green"},on:{click:function(t){return t.stopPropagation(),e.changeStatus(i)}}},[s("v-icon",{staticClass:"mr-2",attrs:{right:"",dark:""}},[e._v(" mdi-checkbox-marked-circle-outline ")]),e._v(" "+e._s(e.$t("App.ihris-search-code.enable"))+" ")],1):s("v-btn",{staticClass:"white--text text-none",attrs:{small:"",color:"secondary"},on:{click:function(t){return t.stopPropagation(),e.changeStatus(i)}}},[s("v-icon",{staticClass:"mr-2",attrs:{right:"",dark:""}},[e._v(" mdi-close-octagon-outline ")]),e._v(" "+e._s(e.$t("App.ihris-search-code.disable"))+" ")],1)]}}])})],1)],1)},r=[],a=(s(6699),{name:"ihris-search-code",props:["profile","fields","label","terms","page","resource","add-link"],data:function(){return{debug:"",search:"",headers:[],results:[],options:{itemsPerPage:10},loading:!1,total:0,error_message:null}},watch:{},created:function(){for(let e of this.fields)this.headers.push({text:this.$t(`App.ihris-search-code.${e[0]}`),value:e[1]});this.headers.push({text:this.$t("App.ihris-search-code.status"),value:"isActive"})},mounted:function(){this.getData()},methods:{changeStatus:function(e){let t="/fhir/CodeSystem"+this.profile.substring(this.profile.lastIndexOf("/"));fetch(t).then((s=>{s.ok?s.json().then((async s=>{let i=s.concept.find((t=>t.code===e.code));if(i.code.includes("(deactivated)")){i.code=i.code.replace("(deactivated)","");let e=s.version.split(".");++e[e.length-1],s.version=e.join(".")}else if(s.version){i.code=`${i.code}(deactivated)`;let e=s.version.split(".");++e[e.length-1],s.version=e.join(".")}try{await fetch(t,{method:"PUT",headers:{"Content-Type":"application/fhir+json"},body:JSON.stringify(s)}),fetch(`/fhir/ValueSet?reference=${s.url}`).then((e=>{e.ok?e.json().then((async e=>{if(e.entry.length>0){let s=e.entry[0].resource;if(s.version){let e=s.version.split(".");++e[e.length-1],s.version=e.join(".")}try{let e=await fetch(`/fhir/ValueSet/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/fhir+json"},body:JSON.stringify(s)});console.log(e.json()),this.$router.go()}catch(t){console.log(t)}}})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)})):(this.loading=!1,this.error_message="Unable to load results.",console.log("Invalid response",e),e.text().then((e=>{console.log("body text:",e)})).catch((e=>{console.log("Failed to get text:",e)})))})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))}catch(r){console.log(r)}})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)})):(this.loading=!1,this.error_message="Unable to load results.",console.log("Invalid response",s),s.text().then((e=>{console.log("body text:",e)})).catch((e=>{console.log("Failed to get text:",e)})))})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))},clickIt:function(e){this.$router.push({name:"resource_view",params:{page:this.page,id:e.code}})},getData:function(){this.loading=!0,this.error_message=null;let e="/fhir/CodeSystem"+this.profile.substring(this.profile.lastIndexOf("/"));fetch(e).then((e=>{e.ok?e.json().then((async e=>{if(this.results=[],e.concept&&e.concept.length>0)for(let t of e.concept){let s={code:t.code,display:t.display,definition:t.definition};if(t.property&&e.property)for(let i of e.property){let e=t.property.find((e=>e.code===i.code));e&&("code"===i.type?e.valueCode?s[i.code]=await this.$fhirutils.codeLookup(i.uri,e.valueCode):s[i.code]="":"Coding"===i.type?e.valueCoding?s[i.code]=await this.$fhirutils.codeLookup(e.valueCoding.system,e.valueCoding.code,i.uri):s[i.code]="":s[i.code]=e["value"+i.type.charAt(0).toUpperCase()+i.type.slice(1)])}this.results.push(s)}this.total=e.concept.length,this.loading=!1})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)})):(this.loading=!1,this.error_message="Unable to load results.",console.log("Invalid response",e),e.text().then((e=>{console.log("body text:",e)})).catch((e=>{console.log("Failed to get text:",e)})))})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",console.log(e)}))}}}),o=a,l=s(3736),n=s(3453),c=s.n(n),h=s(3150),d=s(2371),u=s(7118),p=s(4228),m=s(6957),g=s(6428),f=s(9762),v=s(5978),b=(0,l.Z)(o,i,r,!1,null,null,null),_=b.exports;c()(b,{VBtn:h.Z,VCard:d.Z,VCardSubtitle:u.Qq,VCardTitle:u.EB,VContainer:p.Z,VDataTable:m.Z,VIcon:g.Z,VSpacer:f.Z,VTextField:v.Z})},9725:function(e,t,s){s.r(t),s.d(t,{default:function(){return p}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.binding?s("v-select",{staticClass:"ma-2",attrs:{loading:e.loading,label:e.$t("App.ihris-search-term."+e.label),items:e.items.filter((function(e){return!e.code.includes("(deactivated)")})),outlined:"","error-messages":e.err_messages,error:e.error,clearable:"","hide-details":"","small-chips":"",dense:"",multiple:"","item-text":"display","item-value":"code"},on:{change:function(t){return e.updateSearch()},"click:clear":function(t){return e.clearSearch()}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}):s("v-text-field",{staticClass:"ma-2",attrs:{label:e.$t("App.ihris-search-term."+e.label),dense:"",outlined:"","hide-details":"",clearable:""},on:{change:function(t){return e.updateSearch()},"click:clear":function(t){return e.clearSearch()}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})},r=[],a={name:"ihris-search-term",props:["label","expression","binding"],data:function(){return{loading:!1,items:[],error:!1,err_messages:null,value:[]}},mounted:function(){this.loading=!0,this.$fhirutils.expand(this.binding).then((e=>{this.items=e,this.loading=!1})).catch((e=>{this.error=!0,this.err_messages=e.message,this.loading=!1}))},methods:{updateSearch:function(){this.$emit("termChange",this.expression,this.value)},clearSearch:function(){this.$emit("termChange",this.expression,[])}}},o=a,l=s(3736),n=s(3453),c=s.n(n),h=s(3986),d=s(5978),u=(0,l.Z)(o,i,r,!1,null,null,null),p=u.exports;c()(u,{VSelect:h.Z,VTextField:d.Z})},5657:function(e,t,s){s.r(t),s.d(t,{default:function(){return b}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{staticClass:"py-5"},[s("v-card",[s("v-card-title",[e._v(" "+e._s(e.$t("App.ihris-search.search"))+" "+e._s(e.$t("App.ihris-search."+e.label))+" "),s("v-spacer"),s("v-btn",{class:e.addLink&&e.addLink.class||"primary",attrs:{to:e.addLink?e.addLink.url:"/resource/add/"+e.page}},[e.addLink&&e.addLink.icon?s("v-icon",[e._v(e._s(e.addLink.icon))]):s("v-icon",[e._v("mdi-database-plus")]),e._v(" "+e._s(e.$t("App.ihris-search.add"))+" "+e._s(e.$t("App.ihris-search."+e.label))+" ")],1)],1),s("v-card-title",[e._t("default")],2),e.error_message?s("v-card-subtitle",{staticClass:"white--text error"},[e._v(e._s(e.error_message))]):e._e(),s("v-card-text",[s("v-container"),s("v-data-table",{staticClass:"elevation-1",staticStyle:{cursor:"pointer"},attrs:{headers:e.headers,items:e.results,"item-key":"id",options:e.options,"server-items-length":e.total,"footer-props":{"items-per-page-text":e.$t("App.ihris-search.tableText"),"items-per-page-options":[5,10,20,50]},loading:e.loading},on:{"update:options":function(t){e.options=t},"click:row":e.clickIt}})],1)],1)],1)},r=[],a={name:"ihris-search",props:["profile","fields","label","terms","page","resource","add-link"],data:function(){return{debug:"",headers:[],results:[],options:{itemsPerPage:10},loading:!1,total:0,prevPage:-1,link:[],error_message:null,update_again:{rerun:!1,restart:!1}}},watch:{terms:{handler(){this.getData(!0)},deep:!0},options:{handler(){this.getData()},deep:!0}},created:function(){for(let e of this.fields)this.headers.push({text:this.$t(`App.ihris-search.${e[0]}`),value:e[1]})},mounted:function(){this.getData(!0)},methods:{clickIt:function(e){this.$router.push({name:"resource_view",params:{page:this.page,id:e.id}})},checkRerun(){!this.loading&&this.update_again.rerun&&(this.getData(this.update_again.restart),this.update_again={rerun:!1,restart:!1})},getData(e){if(this.loading)return this.update_again.rerun=!0,void(this.update_again.restart=this.update_again.restart||e);this.loading=!0,this.error_message=null;let t="";if(e&&(this.options.page=1),this.options.page>1&&(this.options.page===this.prevPage-1?t=this.link.find((e=>"previous"===e.relation)).url:this.options.page===this.prevPage+1&&(t=this.link.find((e=>"next"===e.relation)).url),t=t.replace(/_getpages=[^&]*&*/,"").replace("/fhir?","/fhir/"+this.resource+"?"),t=t.substring(t.indexOf("/fhir/")),-1===t.indexOf("_total=accurate")&&(t+="&_total=accurate"),this.profile&&(t=t+"&_profile="+this.profile)),""===t){let e=this.options.itemsPerPage||10,s="";for(let t in this.options.sortBy)s&&(s+=","),this.options.sortDesc[t]&&(s+="-"),s+=this.options.sortBy[t];t="/fhir/"+this.resource+"?_count="+e+"&_total=accurate&_profile="+this.profile;let i=Object.keys(this.terms);for(let r of i)Array.isArray(this.terms[r])?this.terms[r].length>0&&(t+="&"+r+"="+this.terms[r].join(",")):this.terms[r]&&(t+="&"+r+"="+this.terms[r]);this.debug=t}this.prevPage=this.options.page,fetch(t).then((e=>{e.json().then((async e=>{if(this.results=[],e.total>0){this.link=e.link;for(let t of e.entry){let e={id:t.resource.id};for(let s of this.fields){let i=this.$fhirpath.evaluate(t.resource,s[1]);e[s[1]]=await this.$fhirutils.lookup(i[0],s[2])}this.results.push(e)}}this.total=e.total,this.loading=!1,this.checkRerun()})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",this.checkRerun(),console.log(e)}))})).catch((e=>{this.loading=!1,this.error_message="Unable to load results.",this.checkRerun(),console.log(e)}))}}},o=a,l=s(3736),n=s(3453),c=s.n(n),h=s(3150),d=s(2371),u=s(7118),p=s(4228),m=s(6957),g=s(6428),f=s(9762),v=(0,l.Z)(o,i,r,!1,null,null,null),b=v.exports;c()(v,{VBtn:h.Z,VCard:d.Z,VCardSubtitle:u.Qq,VCardText:u.ZB,VCardTitle:u.EB,VContainer:p.Z,VDataTable:m.Z,VIcon:g.Z,VSpacer:f.Z})}}]);
//# sourceMappingURL=fhir-search.b0068a85.js.map